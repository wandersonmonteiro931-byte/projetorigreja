<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Projeção - Equipe da Mídia</title>
  <meta name="description" content="Sistema completo de gerenciamento de projeção para igrejas. Controle apresentações, mídias e transmissões em tempo real.">
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --background: 0 0% 100%;
      --foreground: 240 10% 3.9%;
      --card: 0 0% 100%;
      --card-foreground: 240 10% 3.9%;
      --popover: 0 0% 100%;
      --popover-foreground: 240 10% 3.9%;
      --primary: 262.1 83.3% 57.8%;
      --primary-foreground: 0 0% 98%;
      --secondary: 240 4.8% 95.9%;
      --secondary-foreground: 240 5.9% 10%;
      --muted: 240 4.8% 95.9%;
      --muted-foreground: 240 3.8% 46.1%;
      --accent: 240 4.8% 95.9%;
      --accent-foreground: 240 5.9% 10%;
      --destructive: 0 84.2% 60.2%;
      --destructive-foreground: 0 0% 98%;
      --border: 240 5.9% 90%;
      --input: 240 5.9% 90%;
      --ring: 262.1 83.3% 57.8%;
      --radius: 0.5rem;
      --success: 142 76% 36%;
      --warning: 38 92% 50%;
    }

    .dark {
      --background: 240 10% 3.9%;
      --foreground: 0 0% 98%;
      --card: 240 10% 3.9%;
      --card-foreground: 0 0% 98%;
      --popover: 240 10% 3.9%;
      --popover-foreground: 0 0% 98%;
      --primary: 263.4 70% 50.4%;
      --primary-foreground: 0 0% 98%;
      --secondary: 240 3.7% 15.9%;
      --secondary-foreground: 0 0% 98%;
      --muted: 240 3.7% 15.9%;
      --muted-foreground: 240 5% 64.9%;
      --accent: 240 3.7% 15.9%;
      --accent-foreground: 0 0% 98%;
      --destructive: 0 62.8% 30.6%;
      --destructive-foreground: 0 0% 98%;
      --border: 240 3.7% 15.9%;
      --input: 240 3.7% 15.9%;
      --ring: 263.4 70% 50.4%;
    }

    html { scroll-behavior: smooth; }
    
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background-color: hsl(var(--background));
      color: hsl(var(--foreground));
      line-height: 1.5;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }

    .hidden { display: none !important; }
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .flex-row { flex-direction: row; }
    .flex-1 { flex: 1; }
    .flex-wrap { flex-wrap: wrap; }
    .flex-shrink-0 { flex-shrink: 0; }
    .items-center { align-items: center; }
    .items-start { align-items: flex-start; }
    .justify-center { justify-content: center; }
    .justify-between { justify-content: space-between; }
    .justify-end { justify-content: flex-end; }
    .gap-1 { gap: 0.25rem; }
    .gap-2 { gap: 0.5rem; }
    .gap-3 { gap: 0.75rem; }
    .gap-4 { gap: 1rem; }
    .gap-6 { gap: 1.5rem; }
    .space-y-2 > * + * { margin-top: 0.5rem; }
    .space-y-3 > * + * { margin-top: 0.75rem; }
    .space-y-4 > * + * { margin-top: 1rem; }
    .space-y-6 > * + * { margin-top: 1.5rem; }
    .grid { display: grid; }
    .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
    .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    .grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
    .w-full { width: 100%; }
    .h-full { height: 100%; }
    .h-screen { height: 100vh; }
    .min-h-screen { min-height: 100vh; }
    .max-w-md { max-width: 28rem; }
    .max-w-lg { max-width: 32rem; }
    .max-w-7xl { max-width: 80rem; }
    .mx-auto { margin-left: auto; margin-right: auto; }
    .p-2 { padding: 0.5rem; }
    .p-3 { padding: 0.75rem; }
    .p-4 { padding: 1rem; }
    .p-5 { padding: 1.25rem; }
    .p-6 { padding: 1.5rem; }
    .p-8 { padding: 2rem; }
    .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
    .px-4 { padding-left: 1rem; padding-right: 1rem; }
    .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
    .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
    .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
    .pt-2 { padding-top: 0.5rem; }
    .pb-2 { padding-bottom: 0.5rem; }
    .pb-3 { padding-bottom: 0.75rem; }
    .mb-1 { margin-bottom: 0.25rem; }
    .mb-2 { margin-bottom: 0.5rem; }
    .mb-3 { margin-bottom: 0.75rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mt-1 { margin-top: 0.25rem; }
    .mt-2 { margin-top: 0.5rem; }
    .mt-4 { margin-top: 1rem; }
    .mr-1 { margin-right: 0.25rem; }
    .mr-2 { margin-right: 0.5rem; }
    .ml-2 { margin-left: 0.5rem; }
    .ml-auto { margin-left: auto; }
    .text-xs { font-size: 0.75rem; line-height: 1rem; }
    .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
    .text-base { font-size: 1rem; line-height: 1.5rem; }
    .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
    .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
    .text-2xl { font-size: 1.5rem; line-height: 2rem; }
    .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
    .text-4xl { font-size: 2.25rem; line-height: 2.5rem; }
    .font-medium { font-weight: 500; }
    .font-semibold { font-weight: 600; }
    .font-bold { font-weight: 700; }
    .text-center { text-align: center; }
    .text-right { text-align: right; }
    .uppercase { text-transform: uppercase; }
    .tracking-wide { letter-spacing: 0.025em; }
    .leading-tight { line-height: 1.25; }
    .text-foreground { color: hsl(var(--foreground)); }
    .text-muted-foreground { color: hsl(var(--muted-foreground)); }
    .text-primary { color: hsl(var(--primary)); }
    .text-destructive { color: hsl(var(--destructive)); }
    .text-white { color: #ffffff; }
    .text-green-500 { color: #22c55e; }
    .text-amber-500 { color: #f59e0b; }
    .text-amber-600 { color: #d97706; }
    .text-yellow-500 { color: #eab308; }
    .text-blue-500 { color: #3b82f6; }
    .bg-background { background-color: hsl(var(--background)); }
    .bg-card { background-color: hsl(var(--card)); }
    .bg-muted { background-color: hsl(var(--muted)); }
    .bg-primary { background-color: hsl(var(--primary)); }
    .bg-destructive { background-color: hsl(var(--destructive)); }
    .bg-black { background-color: #000000; }
    .bg-white { background-color: #ffffff; }
    .border { border: 1px solid hsl(var(--border)); }
    .border-t { border-top: 1px solid hsl(var(--border)); }
    .border-b { border-bottom: 1px solid hsl(var(--border)); }
    .border-r { border-right: 1px solid hsl(var(--border)); }
    .border-primary { border-color: hsl(var(--primary)); }
    .border-destructive { border-color: hsl(var(--destructive)); }
    .border-dashed { border-style: dashed; }
    .rounded { border-radius: var(--radius); }
    .rounded-md { border-radius: calc(var(--radius) - 2px); }
    .rounded-lg { border-radius: var(--radius); }
    .rounded-xl { border-radius: calc(var(--radius) + 4px); }
    .rounded-2xl { border-radius: 1rem; }
    .rounded-full { border-radius: 9999px; }
    .shadow { box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1); }
    .shadow-md { box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
    .shadow-lg { box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1); }
    .shadow-xl { box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1); }
    .shadow-2xl { box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25); }
    .overflow-hidden { overflow: hidden; }
    .overflow-auto { overflow: auto; }
    .overflow-y-auto { overflow-y: auto; }
    .overflow-x-auto { overflow-x: auto; }
    .relative { position: relative; }
    .absolute { position: absolute; }
    .fixed { position: fixed; }
    .sticky { position: sticky; top: 0; z-index: 10; }
    .inset-0 { inset: 0; }
    .top-0 { top: 0; }
    .top-2 { top: 0.5rem; }
    .right-2 { right: 0.5rem; }
    .right-3 { right: 0.75rem; }
    .bottom-0 { bottom: 0; }
    .left-0 { left: 0; }
    .z-10 { z-index: 10; }
    .z-20 { z-index: 20; }
    .z-50 { z-index: 50; }
    .cursor-pointer { cursor: pointer; }
    .cursor-move { cursor: move; }
    .select-none { user-select: none; }
    .pointer-events-none { pointer-events: none; }
    .transition { transition: all 150ms ease-in-out; }
    .transition-colors { transition: color 150ms, background-color 150ms, border-color 150ms; }
    .transition-transform { transition: transform 150ms; }
    .duration-200 { transition-duration: 200ms; }
    .duration-300 { transition-duration: 300ms; }
    .opacity-0 { opacity: 0; }
    .opacity-50 { opacity: 0.5; }
    .opacity-70 { opacity: 0.7; }
    .opacity-80 { opacity: 0.8; }
    .aspect-video { aspect-ratio: 16 / 9; }
    .aspect-square { aspect-ratio: 1 / 1; }
    .object-cover { object-fit: cover; }
    .object-contain { object-fit: contain; }
    .truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .shrink-0 { flex-shrink: 0; }
    .grow { flex-grow: 1; }
    .tabular-nums { font-variant-numeric: tabular-nums; }
    .whitespace-nowrap { white-space: nowrap; }
    .whitespace-pre-wrap { white-space: pre-wrap; }
    .break-words { word-wrap: break-word; }
    
    @media (min-width: 640px) {
      .sm\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (min-width: 768px) {
      .md\:flex { display: flex; }
      .md\:hidden { display: none; }
      .md\:flex-row { flex-direction: row; }
      .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .md\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
      .md\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
      .md\:items-center { align-items: center; }
      .md\:justify-between { justify-content: space-between; }
      .md\:p-6 { padding: 1.5rem; }
      .md\:gap-6 { gap: 1.5rem; }
      .md\:w-64 { width: 16rem; }
      .md\:text-sm { font-size: 0.875rem; }
    }
    @media (min-width: 1024px) {
      .lg\:w-80 { width: 20rem; }
      .lg\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .lg\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
      .lg\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
    }

    /* Component Styles */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
      border-radius: var(--radius);
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 150ms;
      cursor: pointer;
      border: 1px solid transparent;
      outline: none;
      padding: 0.5rem 1rem;
      min-height: 2.25rem;
    }
    .btn:focus-visible {
      outline: 2px solid hsl(var(--ring));
      outline-offset: 2px;
    }
    .btn:disabled {
      pointer-events: none;
      opacity: 0.5;
    }
    .btn-primary {
      background-color: hsl(var(--primary));
      color: hsl(var(--primary-foreground));
    }
    .btn-primary:hover {
      background-color: hsl(var(--primary) / 0.9);
    }
    .btn-secondary {
      background-color: hsl(var(--secondary));
      color: hsl(var(--secondary-foreground));
    }
    .btn-secondary:hover {
      background-color: hsl(var(--secondary) / 0.8);
    }
    .btn-destructive {
      background-color: hsl(var(--destructive));
      color: hsl(var(--destructive-foreground));
    }
    .btn-destructive:hover {
      background-color: hsl(var(--destructive) / 0.9);
    }
    .btn-outline {
      border: 1px solid hsl(var(--border));
      background-color: transparent;
      color: hsl(var(--foreground));
    }
    .btn-outline:hover {
      background-color: hsl(var(--accent));
    }
    .btn-ghost {
      background-color: transparent;
      color: hsl(var(--foreground));
    }
    .btn-ghost:hover {
      background-color: hsl(var(--accent));
    }
    .btn-success {
      background-color: hsl(var(--success));
      color: white;
    }
    .btn-success:hover {
      background-color: hsl(var(--success) / 0.9);
    }
    .btn-warning {
      background-color: hsl(var(--warning));
      color: white;
    }
    .btn-sm { padding: 0.25rem 0.75rem; min-height: 2rem; font-size: 0.8125rem; }
    .btn-lg { padding: 0.625rem 1.5rem; min-height: 2.75rem; }
    .btn-icon { padding: 0; width: 2.25rem; height: 2.25rem; min-height: unset; }
    .btn-full { width: 100%; }
    
    .card {
      background-color: hsl(var(--card));
      border: 1px solid hsl(var(--border));
      border-radius: var(--radius);
      color: hsl(var(--card-foreground));
    }

    .input, .textarea, .select {
      display: flex;
      width: 100%;
      border-radius: var(--radius);
      border: 1px solid hsl(var(--input));
      background-color: hsl(var(--background));
      padding: 0.5rem 0.75rem;
      font-size: 0.875rem;
      color: hsl(var(--foreground));
      transition: border-color 150ms, box-shadow 150ms;
    }
    .input:focus, .textarea:focus, .select:focus {
      outline: none;
      border-color: hsl(var(--ring));
      box-shadow: 0 0 0 2px hsl(var(--ring) / 0.2);
    }
    .input::placeholder, .textarea::placeholder {
      color: hsl(var(--muted-foreground));
    }
    .input:disabled, .textarea:disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }
    .input-h-11 { min-height: 2.75rem; }
    .textarea { min-height: 5rem; resize: vertical; }

    .label {
      font-size: 0.875rem;
      font-weight: 500;
      color: hsl(var(--foreground));
      display: block;
      margin-bottom: 0.375rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      border-radius: 9999px;
      padding: 0.125rem 0.625rem;
      font-size: 0.75rem;
      font-weight: 600;
      transition: all 150ms;
    }
    .badge-default {
      background-color: hsl(var(--primary));
      color: hsl(var(--primary-foreground));
    }
    .badge-secondary {
      background-color: hsl(var(--secondary));
      color: hsl(var(--secondary-foreground));
    }
    .badge-destructive {
      background-color: hsl(var(--destructive));
      color: hsl(var(--destructive-foreground));
    }
    .badge-success {
      background-color: #22c55e;
      color: white;
    }
    .badge-outline {
      border: 1px solid hsl(var(--border));
      background-color: transparent;
    }

    .separator {
      height: 1px;
      width: 100%;
      background-color: hsl(var(--border));
      margin: 0.75rem 0;
    }

    .tabs {
      display: flex;
      gap: 0.25rem;
      background-color: hsl(var(--muted));
      padding: 0.25rem;
      border-radius: var(--radius);
    }
    .tab {
      flex: 1;
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      color: hsl(var(--muted-foreground));
      background: transparent;
      border: none;
      border-radius: calc(var(--radius) - 2px);
      cursor: pointer;
      transition: all 150ms;
    }
    .tab:hover {
      color: hsl(var(--foreground));
    }
    .tab.active {
      background-color: hsl(var(--background));
      color: hsl(var(--foreground));
      box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
    }

    .table {
      width: 100%;
      font-size: 0.875rem;
      border-collapse: collapse;
    }
    .table th, .table td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid hsl(var(--border));
    }
    .table th {
      font-weight: 500;
      color: hsl(var(--muted-foreground));
    }
    .table-text-right { text-align: right; }

    .slider-container {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .slider {
      -webkit-appearance: none;
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: hsl(var(--secondary));
      outline: none;
    }
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: hsl(var(--primary));
      cursor: pointer;
    }
    .slider::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: hsl(var(--primary));
      cursor: pointer;
      border: none;
    }

    .scroll-area {
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: hsl(var(--border)) transparent;
    }
    .scroll-area::-webkit-scrollbar {
      width: 6px;
    }
    .scroll-area::-webkit-scrollbar-track {
      background: transparent;
    }
    .scroll-area::-webkit-scrollbar-thumb {
      background: hsl(var(--border));
      border-radius: 3px;
    }

    .icon {
      width: 1rem;
      height: 1rem;
      stroke-width: 2;
    }
    .icon-lg {
      width: 1.25rem;
      height: 1.25rem;
      stroke-width: 2;
    }
    .icon-xl {
      width: 1.5rem;
      height: 1.5rem;
      stroke-width: 2;
    }
    .icon-2xl {
      width: 2rem;
      height: 2rem;
      stroke-width: 2;
    }

    /* Toast */
    .toast-container {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      z-index: 100;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      max-width: 24rem;
    }
    .toast {
      background-color: hsl(var(--card));
      border: 1px solid hsl(var(--border));
      border-radius: var(--radius);
      padding: 1rem;
      box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
      animation: slideIn 0.3s ease-out;
    }
    .toast-title {
      font-weight: 600;
      font-size: 0.875rem;
      margin-bottom: 0.25rem;
    }
    .toast-description {
      font-size: 0.8125rem;
      color: hsl(var(--muted-foreground));
    }
    .toast-destructive {
      border-color: hsl(var(--destructive));
    }
    .toast-destructive .toast-title {
      color: hsl(var(--destructive));
    }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* Dialog / Modal */
    .dialog-overlay {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(2px);
      z-index: 50;
      animation: fadeIn 0.2s ease-out;
    }
    .dialog {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      z-index: 51;
      background-color: hsl(var(--background));
      border: 1px solid hsl(var(--border));
      border-radius: var(--radius);
      box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
      width: 90%;
      max-width: 32rem;
      max-height: 90vh;
      overflow-y: auto;
      animation: dialogIn 0.2s ease-out;
    }
    .dialog-header {
      padding: 1.5rem;
      padding-bottom: 0;
    }
    .dialog-title {
      font-size: 1.125rem;
      font-weight: 600;
    }
    .dialog-description {
      font-size: 0.875rem;
      color: hsl(var(--muted-foreground));
      margin-top: 0.5rem;
    }
    .dialog-content {
      padding: 1.5rem;
    }
    .dialog-footer {
      padding: 1.5rem;
      padding-top: 0;
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
    }
    .dialog-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes dialogIn {
      from { opacity: 0; transform: translate(-50%, -48%) scale(0.95); }
      to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }

    /* Sidebar Styles */
    .sidebar {
      width: 16rem;
      background-color: hsl(var(--card));
      border-right: 1px solid hsl(var(--border));
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    .sidebar-header {
      padding: 1rem;
      border-bottom: 1px solid hsl(var(--border));
    }
    .sidebar-content {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }
    .sidebar-footer {
      padding: 1rem;
      border-top: 1px solid hsl(var(--border));
    }

    /* Media Item Styles */
    .media-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem;
      border-radius: var(--radius);
      cursor: pointer;
      transition: all 150ms;
      border: 1px solid transparent;
    }
    .media-item:hover {
      background-color: hsl(var(--accent));
    }
    .media-item.active {
      background-color: hsl(var(--primary) / 0.1);
      border-color: hsl(var(--primary));
    }
    .media-item.playing {
      background-color: hsl(var(--success) / 0.1);
      border-color: hsl(var(--success));
    }
    .media-thumbnail {
      width: 3rem;
      height: 3rem;
      border-radius: calc(var(--radius) - 2px);
      background-color: hsl(var(--muted));
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      flex-shrink: 0;
    }
    .media-thumbnail img,
    .media-thumbnail video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .media-info {
      flex: 1;
      min-width: 0;
    }
    .media-name {
      font-size: 0.875rem;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .media-type {
      font-size: 0.75rem;
      color: hsl(var(--muted-foreground));
    }

    /* Preview Container */
    .preview-container {
      background-color: #000;
      border-radius: var(--radius);
      overflow: hidden;
      aspect-ratio: 16 / 9;
      position: relative;
    }
    .preview-content {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      text-align: center;
      padding: 1rem;
    }

    /* Projector Screen */
    .projector-screen {
      position: fixed;
      inset: 0;
      background-color: #000;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .projector-content {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      text-align: center;
    }
    .projector-text {
      font-size: 3rem;
      font-weight: 700;
    }
    .projector-subtitle {
      font-size: 1.5rem;
      opacity: 0.7;
      margin-top: 1rem;
    }
    .projector-media {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* Theme Toggle */
    .theme-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 2.25rem;
      height: 2.25rem;
      border-radius: var(--radius);
      background-color: transparent;
      border: none;
      color: hsl(var(--foreground));
      cursor: pointer;
      transition: background-color 150ms;
    }
    .theme-toggle:hover {
      background-color: hsl(var(--accent));
    }

    /* Password Strength */
    .password-strength-container {
      display: flex;
      gap: 0.25rem;
      margin-top: 0.5rem;
    }
    .password-strength-bar {
      flex: 1;
      height: 4px;
      background-color: hsl(var(--muted));
      border-radius: 2px;
      transition: background-color 300ms;
    }
    .password-strength-bar.active-1 { background-color: #ef4444; }
    .password-strength-bar.active-2 { background-color: #f97316; }
    .password-strength-bar.active-3 { background-color: #eab308; }
    .password-strength-bar.active-4 { background-color: #22c55e; }

    /* Activity Dot */
    .activity-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
      margin-top: 0.375rem;
    }

    /* Stats Card */
    .stats-card {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .stats-icon {
      width: 3rem;
      height: 3rem;
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Feature Carousel */
    .feature-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: hsl(var(--muted));
      border: none;
      cursor: pointer;
      transition: all 200ms;
    }
    .feature-dot.active {
      background-color: hsl(var(--primary));
      transform: scale(1.25);
    }

    /* Switch */
    .switch {
      position: relative;
      width: 2.5rem;
      height: 1.5rem;
      background-color: hsl(var(--muted));
      border-radius: 9999px;
      cursor: pointer;
      transition: background-color 200ms;
      border: none;
    }
    .switch::after {
      content: '';
      position: absolute;
      left: 2px;
      top: 2px;
      width: 1.25rem;
      height: 1.25rem;
      background-color: white;
      border-radius: 50%;
      transition: transform 200ms;
      box-shadow: 0 1px 3px rgb(0 0 0 / 0.2);
    }
    .switch.active {
      background-color: hsl(var(--primary));
    }
    .switch.active::after {
      transform: translateX(1rem);
    }

    /* Gradient backgrounds */
    .bg-gradient-primary {
      background: linear-gradient(135deg, hsl(var(--primary) / 0.1) 0%, hsl(var(--primary) / 0.05) 100%);
    }
    .bg-gradient-welcome {
      background: linear-gradient(135deg, hsl(var(--primary) / 0.05) 0%, transparent 100%);
    }

    /* Pulse animation */
    .pulse {
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Heartbeat animation for live button */
    .heartbeat-button {
      animation: heartbeat 1.5s infinite;
    }
    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }

    /* Animate pulse for live indicator */
    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    /* Hover elevate */
    .hover-elevate {
      transition: background-color 150ms, transform 150ms;
    }
    .hover-elevate:hover {
      background-color: hsl(var(--accent));
    }

    /* Input with icon */
    .input-with-icon {
      position: relative;
    }
    .input-with-icon .input {
      padding-right: 2.5rem;
    }
    .input-icon {
      position: absolute;
      right: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      color: hsl(var(--muted-foreground));
      cursor: pointer;
    }

    /* Drop zone */
    .drop-zone {
      border: 2px dashed hsl(var(--border));
      border-radius: var(--radius);
      padding: 2rem;
      text-align: center;
      transition: all 200ms;
      cursor: pointer;
    }
    .drop-zone:hover,
    .drop-zone.active {
      border-color: hsl(var(--primary));
      background-color: hsl(var(--primary) / 0.05);
    }

    /* Projector Live Preview */
    .live-preview {
      aspect-ratio: 16 / 9;
      background-color: #000;
      border-radius: var(--radius);
      overflow: hidden;
      position: relative;
    }
    .live-preview-content {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      text-align: center;
    }

    /* Gallery Grid Item */
    .gallery-item {
      position: relative;
      border-radius: var(--radius);
      overflow: hidden;
      background-color: #000;
      aspect-ratio: 1;
    }
    .gallery-item img,
    .gallery-item video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .gallery-item-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, transparent 50%);
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding: 0.5rem;
      opacity: 0;
      transition: opacity 200ms;
    }
    .gallery-item:hover .gallery-item-overlay {
      opacity: 1;
    }

    /* Playlist item */
    .playlist-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem;
      background-color: hsl(var(--background));
      border: 1px solid hsl(var(--border));
      border-radius: var(--radius);
      margin-bottom: 0.5rem;
      transition: all 150ms;
    }
    .playlist-item:hover {
      background-color: hsl(var(--accent));
    }
    .playlist-item.current {
      border-color: hsl(var(--primary));
      background-color: hsl(var(--primary) / 0.1);
    }
    .playlist-item.dragging {
      opacity: 0.5;
      background-color: hsl(var(--accent));
    }
    .playlist-item-grip {
      color: hsl(var(--muted-foreground));
      cursor: move;
    }
    .playlist-item-thumbnail {
      width: 3.5rem;
      height: 2rem;
      background-color: hsl(var(--muted));
      border-radius: calc(var(--radius) - 2px);
      overflow: hidden;
      flex-shrink: 0;
    }
    .playlist-item-thumbnail img,
    .playlist-item-thumbnail video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .playlist-item-info {
      flex: 1;
      min-width: 0;
    }
    .playlist-item-name {
      font-size: 0.875rem;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .playlist-item-type {
      font-size: 0.75rem;
      color: hsl(var(--muted-foreground));
    }
    .playlist-item-actions {
      display: flex;
      gap: 0.25rem;
    }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: hsl(var(--muted-foreground));
    }
    .empty-state-icon {
      width: 4rem;
      height: 4rem;
      margin: 0 auto 1rem;
      opacity: 0.5;
    }

    /* Control header */
    .control-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem;
      border-bottom: 1px solid hsl(var(--border));
      background-color: hsl(var(--card));
    }

    /* Text slide styles */
    .text-slide-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      padding: 2rem;
      text-align: center;
    }
    .text-slide-title {
      font-weight: 700;
      margin-bottom: 1rem;
    }
    .text-slide-body {
      line-height: 1.6;
      white-space: pre-wrap;
    }

    /* Responsive sidebar */
    @media (max-width: 767px) {
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 40;
        transform: translateX(-100%);
        transition: transform 300ms;
        box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
      }
      .sidebar.open {
        transform: translateX(0);
      }
      .sidebar-overlay {
        position: fixed;
        inset: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 39;
      }
    }

    /* Print styles */
    @media print {
      .no-print { display: none !important; }
    }
  </style>
</head>
<body>
  <!-- LOADING SCREEN -->
  <div id="loading-screen" class="hidden min-h-screen bg-background flex items-center justify-center">
    <div class="text-center">
      <div class="animate-pulse mb-4">
        <svg class="icon-2xl text-primary mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
          <line x1="8" y1="21" x2="16" y2="21"></line>
          <line x1="12" y1="17" x2="12" y2="21"></line>
        </svg>
      </div>
      <p class="text-muted-foreground">Carregando...</p>
    </div>
  </div>

  <!-- LOGIN PAGE -->
  <div id="login-page" class="min-h-screen bg-background flex items-center justify-center p-4">
    <div class="fixed top-2 right-2 z-50">
      <button class="theme-toggle" onclick="toggleTheme()" data-testid="button-theme-toggle">
        <svg class="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24" id="theme-icon">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
      </button>
    </div>

    <div class="w-full max-w-md">
      <div class="card p-8">
        <div class="text-center mb-8">
          <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary mb-4">
            <svg class="icon-xl text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
              <line x1="8" y1="21" x2="16" y2="21"></line>
              <line x1="12" y1="17" x2="12" y2="21"></line>
            </svg>
          </div>
          <h1 class="text-2xl font-bold" data-testid="text-login-title">Entrar</h1>
          <p class="text-muted-foreground mt-2">Sistema de Projeção - Equipe da Mídia</p>
        </div>

        <form id="login-form" class="space-y-4">
          <div id="login-error" class="hidden p-3 rounded-lg bg-destructive text-destructive-foreground text-sm">
            <div class="flex items-center gap-2">
              <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
              </svg>
              <span id="login-error-text"></span>
            </div>
          </div>

          <div class="space-y-2">
            <label class="label" for="login-identifier">Email ou nome de usuário</label>
            <input type="text" id="login-identifier" class="input input-h-11" placeholder="Digite seu email ou usuário" required data-testid="input-login-identifier">
          </div>

          <div class="space-y-2">
            <div class="flex items-center justify-between">
              <label class="label" for="login-password">Senha</label>
              <button type="button" class="text-sm text-primary hover:underline" onclick="showPage('forgot-password')" data-testid="link-forgot-password">Esqueci minha senha</button>
            </div>
            <div class="input-with-icon">
              <input type="password" id="login-password" class="input input-h-11" placeholder="Digite sua senha" required data-testid="input-login-password">
              <button type="button" class="input-icon btn btn-ghost btn-icon" onclick="togglePasswordVisibility('login-password', this)" data-testid="button-toggle-password">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              </button>
            </div>
          </div>

          <div class="flex items-center gap-2">
            <button type="button" class="switch" id="remember-switch" onclick="toggleSwitch(this)" data-testid="switch-remember"></button>
            <label class="text-sm cursor-pointer" onclick="toggleSwitch(document.getElementById('remember-switch'))">Lembrar de mim</label>
          </div>

          <button type="submit" class="btn btn-primary btn-full btn-lg" data-testid="button-login">
            <span id="login-btn-text" class="flex items-center gap-2">
              <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                <polyline points="10 17 15 12 10 7"></polyline>
                <line x1="15" y1="12" x2="3" y2="12"></line>
              </svg>
              Entrar
            </span>
            <span id="login-btn-loading" class="hidden flex items-center gap-2">
              <svg class="icon animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
              </svg>
              Entrando...
            </span>
          </button>

          <p class="text-center text-sm text-muted-foreground">
            Não tem conta? <button type="button" class="text-primary hover:underline font-medium" onclick="showPage('register')" data-testid="link-register">Criar conta</button>
          </p>
        </form>
      </div>
    </div>
  </div>

  <!-- REGISTER PAGE -->
  <div id="register-page" class="hidden min-h-screen bg-background flex items-center justify-center p-4">
    <div class="fixed top-2 right-2 z-50">
      <button class="theme-toggle" onclick="toggleTheme()">
        <svg class="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
      </button>
    </div>

    <div class="w-full max-w-md">
      <div class="card p-8">
        <div class="flex items-center gap-2 mb-6">
          <button class="btn btn-ghost btn-icon" onclick="showPage('login')" data-testid="button-back-login">
            <svg class="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
          </button>
          <h1 class="text-2xl font-bold" data-testid="text-register-title">Criar Conta</h1>
        </div>

        <form id="register-form" class="space-y-4">
          <div id="register-error" class="hidden p-3 rounded-lg bg-destructive text-destructive-foreground text-sm">
            <div class="flex items-center gap-2">
              <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
              </svg>
              <span id="register-error-text"></span>
            </div>
          </div>

          <div class="space-y-2">
            <label class="label" for="register-email">Email</label>
            <input type="email" id="register-email" class="input" placeholder="seu@email.com" required data-testid="input-register-email">
          </div>

          <div class="space-y-2">
            <label class="label" for="register-username">Nome de usuário</label>
            <input type="text" id="register-username" class="input" placeholder="Escolha um nome de usuário" required data-testid="input-register-username">
          </div>

          <div class="space-y-2">
            <label class="label" for="register-phone">Telefone</label>
            <input type="tel" id="register-phone" class="input" placeholder="(00) 00000-0000" data-testid="input-register-phone">
          </div>

          <div class="space-y-2">
            <label class="label" for="register-password">Senha</label>
            <div class="input-with-icon">
              <input type="password" id="register-password" class="input" placeholder="Mínimo 6 caracteres" required minlength="6" oninput="updatePasswordStrength()" data-testid="input-register-password">
              <button type="button" class="input-icon btn btn-ghost btn-icon" onclick="togglePasswordVisibility('register-password', this)">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              </button>
            </div>
            <div id="password-strength" class="hidden">
              <div class="password-strength-container">
                <div class="password-strength-bar" id="strength-1"></div>
                <div class="password-strength-bar" id="strength-2"></div>
                <div class="password-strength-bar" id="strength-3"></div>
                <div class="password-strength-bar" id="strength-4"></div>
              </div>
              <p class="text-xs text-muted-foreground mt-1" id="strength-text"></p>
            </div>
          </div>

          <div class="space-y-2">
            <label class="label" for="register-confirm-password">Confirmar senha</label>
            <input type="password" id="register-confirm-password" class="input" placeholder="Digite a senha novamente" required data-testid="input-register-confirm-password">
          </div>

          <div class="separator"></div>

          <p class="text-sm text-muted-foreground">Perguntas de segurança (para recuperação de senha)</p>

          <div class="space-y-2">
            <label class="label" for="register-q1">Qual o nome do seu primeiro animal de estimação?</label>
            <input type="text" id="register-q1" class="input" placeholder="Sua resposta" required data-testid="input-register-q1">
          </div>

          <div class="space-y-2">
            <label class="label" for="register-q2">Qual o modelo do seu primeiro carro?</label>
            <input type="text" id="register-q2" class="input" placeholder="Sua resposta" required data-testid="input-register-q2">
          </div>

          <div class="space-y-2">
            <label class="label" for="register-q3">Qual o nome do seu livro favorito?</label>
            <input type="text" id="register-q3" class="input" placeholder="Sua resposta" required data-testid="input-register-q3">
          </div>

          <button type="submit" class="btn btn-primary btn-full btn-lg" data-testid="button-register">
            <span id="register-btn-text" class="flex items-center gap-2">
              <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <line x1="20" y1="8" x2="20" y2="14"></line>
                <line x1="23" y1="11" x2="17" y2="11"></line>
              </svg>
              Criar conta
            </span>
            <span id="register-btn-loading" class="hidden flex items-center gap-2">
              <svg class="icon animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
              </svg>
              Criando...
            </span>
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- FORGOT PASSWORD PAGE -->
  <div id="forgot-password-page" class="hidden min-h-screen bg-background flex items-center justify-center p-4">
    <div class="fixed top-2 right-2 z-50">
      <button class="theme-toggle" onclick="toggleTheme()">
        <svg class="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
      </button>
    </div>

    <div class="w-full max-w-md">
      <div class="card p-8">
        <div class="flex items-center gap-2 mb-6">
          <button class="btn btn-ghost btn-icon" onclick="showPage('login')" data-testid="button-back-forgot">
            <svg class="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
          </button>
          <h1 class="text-2xl font-bold" data-testid="text-forgot-title">Recuperar Senha</h1>
        </div>

        <!-- Step 1: Enter identifier -->
        <div id="forgot-step-1">
          <form id="forgot-form-1" class="space-y-4">
            <p class="text-sm text-muted-foreground mb-4">Digite seu email ou nome de usuário para recuperar sua senha.</p>
            
            <div class="space-y-2">
              <label class="label" for="forgot-identifier">Email ou nome de usuário</label>
              <input type="text" id="forgot-identifier" class="input input-h-11" placeholder="Digite seu email ou usuário" required data-testid="input-forgot-identifier">
            </div>

            <button type="submit" class="btn btn-primary btn-full btn-lg" data-testid="button-forgot-step1">
              Continuar
              <svg class="icon ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
          </form>
        </div>

        <!-- Step 2: Security questions -->
        <div id="forgot-step-2" class="hidden">
          <form id="forgot-form-2" class="space-y-4">
            <p class="text-sm text-muted-foreground mb-4">Responda às perguntas de segurança.</p>

            <div id="forgot-error-2" class="hidden p-3 rounded-lg bg-destructive text-destructive-foreground text-sm">
              <span id="forgot-error-2-text"></span>
            </div>
            
            <div class="space-y-2">
              <label class="label" id="forgot-q1-label">Pergunta 1</label>
              <input type="text" id="forgot-a1" class="input" placeholder="Sua resposta" required data-testid="input-forgot-a1">
            </div>

            <div class="space-y-2">
              <label class="label" id="forgot-q2-label">Pergunta 2</label>
              <input type="text" id="forgot-a2" class="input" placeholder="Sua resposta" required data-testid="input-forgot-a2">
            </div>

            <div class="space-y-2">
              <label class="label" id="forgot-q3-label">Pergunta 3</label>
              <input type="text" id="forgot-a3" class="input" placeholder="Sua resposta" required data-testid="input-forgot-a3">
            </div>

            <button type="submit" class="btn btn-primary btn-full btn-lg" data-testid="button-forgot-step2">
              Verificar Respostas
              <svg class="icon ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
          </form>
        </div>

        <!-- Step 3: New password -->
        <div id="forgot-step-3" class="hidden">
          <form id="forgot-form-3" class="space-y-4">
            <p class="text-sm text-muted-foreground mb-4">Crie uma nova senha para sua conta.</p>

            <div id="forgot-error-3" class="hidden p-3 rounded-lg bg-destructive text-destructive-foreground text-sm">
              <span id="forgot-error-3-text"></span>
            </div>
            
            <div class="space-y-2">
              <label class="label" for="new-password">Nova senha</label>
              <div class="input-with-icon">
                <input type="password" id="new-password" class="input input-h-11" placeholder="Mínimo 6 caracteres" required minlength="6" data-testid="input-new-password">
                <button type="button" class="input-icon btn btn-ghost btn-icon" onclick="togglePasswordVisibility('new-password', this)">
                  <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                </button>
              </div>
            </div>

            <div class="space-y-2">
              <label class="label" for="confirm-new-password">Confirmar nova senha</label>
              <input type="password" id="confirm-new-password" class="input input-h-11" placeholder="Digite novamente" required data-testid="input-confirm-new-password">
            </div>

            <button type="submit" class="btn btn-primary btn-full btn-lg" data-testid="button-forgot-step3">
              <svg class="icon mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
              </svg>
              Redefinir Senha
            </button>
          </form>
        </div>

        <!-- Step 4: Success -->
        <div id="forgot-step-4" class="hidden text-center py-8">
          <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-green-500 mb-4">
            <svg class="icon-xl text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
          </div>
          <h3 class="text-xl font-bold mb-2">Senha Alterada!</h3>
          <p class="text-muted-foreground mb-4">Sua senha foi redefinida com sucesso.</p>
          <button class="btn btn-primary btn-lg" onclick="showPage('login')" data-testid="button-back-to-login">
            Voltar ao Login
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- USER HOME PAGE -->
  <div id="user-home-page" class="hidden min-h-screen bg-background relative">
    <div class="fixed top-2 right-2 z-50 flex items-center gap-1">
      <button class="theme-toggle" onclick="toggleTheme()">
        <svg class="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
      </button>
      <button class="btn btn-ghost btn-sm" onclick="logout()" data-testid="button-logout">
        <svg class="icon mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
        </svg>
        Sair
      </button>
    </div>

    <main class="max-w-4xl mx-auto p-4 space-y-4">
      <div class="card p-4 bg-gradient-welcome">
        <h1 class="text-xl font-bold text-primary" data-testid="text-welcome-title">Bem-vindo a Equipe da Mídia!</h1>
      </div>

      <div class="card p-6 bg-gradient-primary relative overflow-hidden">
        <div class="flex flex-col gap-4 relative" style="z-index: 10;">
          <div class="flex items-center gap-3">
            <svg class="icon-xl text-yellow-500" id="greeting-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <h2 class="text-2xl font-bold" id="greeting-text" data-testid="text-greeting">Bom dia, Usuário!</h2>
          </div>
          
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div class="flex items-center gap-3">
              <svg class="icon-lg text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M3 21h18M3 7v14M9 7v14M15 7v14M21 7v14M12 3l9 4M12 3L3 7M12 7v4"></path>
              </svg>
              <span class="text-muted-foreground" id="church-name-display" data-testid="text-church-name">Clique para definir o nome da sua igreja</span>
              <button class="btn btn-ghost btn-icon" onclick="editChurchName()" data-testid="button-edit-church">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"></path>
                  <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
              </button>
            </div>
            <button class="btn btn-primary btn-lg shrink-0" onclick="showPage('projector-control')" data-testid="button-open-system">
              <svg class="icon-lg mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                <line x1="8" y1="21" x2="16" y2="21"></line>
                <line x1="12" y1="17" x2="12" y2="21"></line>
              </svg>
              Abrir Sistema
              <svg class="icon ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <div id="announcements-container" class="hidden">
        <div class="card p-5">
          <div class="flex items-center gap-3 mb-4">
            <svg class="icon-lg text-primary pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
              <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
            <h3 class="font-bold">Últimas Notícias</h3>
          </div>
          <div class="space-y-3" id="announcements-list"></div>
        </div>
      </div>

      <div class="card p-6 cursor-pointer hover-elevate" id="feature-carousel" data-testid="card-feature-carousel">
        <div class="flex items-center gap-4">
          <div class="inline-flex items-center justify-center w-16 h-16 rounded-lg" id="feature-icon-wrapper" style="background-color: rgba(59, 130, 246, 0.1);">
            <svg class="icon-xl" id="feature-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: #3b82f6;">
              <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
              <line x1="8" y1="21" x2="16" y2="21"></line>
              <line x1="12" y1="17" x2="12" y2="21"></line>
            </svg>
          </div>
          <div class="flex-1">
            <h3 class="text-xl font-semibold mb-1" id="feature-title" data-testid="text-feature-title">Controle do Projetor</h3>
            <p class="text-muted-foreground" id="feature-description" data-testid="text-feature-description">Gerencie apresentações em tempo real</p>
          </div>
        </div>
      </div>
      <div class="flex justify-center gap-2 mt-4" id="feature-dots"></div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="card p-5 h-full">
          <div class="flex items-center gap-3 mb-4">
            <svg class="icon-lg text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
            <h3 class="font-bold">Dados da Conta</h3>
          </div>
          <div class="space-y-3 text-sm" id="user-info" data-testid="container-user-info"></div>
        </div>

        <div class="card p-5 h-full">
          <div class="flex items-center gap-3 mb-4">
            <svg class="icon-lg text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <h3 class="font-bold">Atividade Recente</h3>
          </div>
          <div class="space-y-3">
            <div class="flex items-start gap-3 p-3 rounded-lg" style="background-color: hsl(var(--muted));">
              <div class="activity-dot" style="background-color: #22c55e;"></div>
              <div>
                <p class="text-sm font-medium">Login realizado</p>
                <p class="text-xs text-muted-foreground">Agora</p>
              </div>
            </div>
            <div class="flex items-start gap-3 p-3 rounded-lg" style="background-color: hsl(var(--muted));">
              <div class="activity-dot" style="background-color: #3b82f6;"></div>
              <div>
                <p class="text-sm font-medium">Sessão iniciada</p>
                <p class="text-xs text-muted-foreground">Sessão ativa</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card p-5">
        <div class="flex items-center gap-3 mb-4">
          <svg class="icon-lg text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"></path>
          </svg>
          <h3 class="font-bold">Dicas Rápidas</h3>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
          <div class="p-4 rounded-lg" style="background-color: hsl(var(--muted));">
            <p class="font-medium mb-1">Atalhos de Teclado</p>
            <p class="text-muted-foreground">Use as setas para navegar entre slides</p>
          </div>
          <div class="p-4 rounded-lg" style="background-color: hsl(var(--muted));">
            <p class="font-medium mb-1">Modo Tela Cheia</p>
            <p class="text-muted-foreground">Pressione F11 para tela cheia</p>
          </div>
          <div class="p-4 rounded-lg" style="background-color: hsl(var(--muted));">
            <p class="font-medium mb-1">Suporte</p>
            <p class="text-muted-foreground">Contate o administrador para ajuda</p>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- ADMIN DASHBOARD PAGE -->
  <div id="admin-page" class="hidden min-h-screen bg-background relative">
    <div class="fixed top-2 right-2 z-50 flex items-center gap-1">
      <button class="theme-toggle" onclick="toggleTheme()">
        <svg class="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
      </button>
      <button class="btn btn-ghost btn-sm" onclick="logout()" data-testid="button-admin-logout">
        <svg class="icon mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
        </svg>
        Sair
      </button>
    </div>

    <main class="max-w-7xl mx-auto p-4 space-y-6">
      <div class="card p-4 bg-gradient-welcome mb-4">
        <h1 class="text-xl font-bold text-primary">Painel Administrativo</h1>
        <p class="text-sm text-muted-foreground">Gerencie usuários, anúncios e configurações</p>
      </div>

      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="card p-4 stats-card">
          <div class="stats-icon" style="background-color: rgba(59, 130, 246, 0.1);">
            <svg class="icon-lg text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
          </div>
          <div>
            <p class="text-2xl font-bold" id="stat-users" data-testid="text-stat-users">0</p>
            <p class="text-xs text-muted-foreground">Total de Usuários</p>
          </div>
        </div>
        
        <div class="card p-4 stats-card">
          <div class="stats-icon" style="background-color: rgba(139, 92, 246, 0.1);">
            <svg class="icon-lg text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
          </div>
          <div>
            <p class="text-2xl font-bold" id="stat-admins" data-testid="text-stat-admins">0</p>
            <p class="text-xs text-muted-foreground">Administradores</p>
          </div>
        </div>

        <div class="card p-4 stats-card">
          <div class="stats-icon" style="background-color: rgba(239, 68, 68, 0.1);">
            <svg class="icon-lg text-destructive" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
              <path d="M7 11V7a5 5 0 0110 0v4"></path>
            </svg>
          </div>
          <div>
            <p class="text-2xl font-bold" id="stat-blocked" data-testid="text-stat-blocked">0</p>
            <p class="text-xs text-muted-foreground">Bloqueados</p>
          </div>
        </div>

        <div class="card p-4 stats-card">
          <div class="stats-icon" style="background-color: rgba(34, 197, 94, 0.1);">
            <svg class="icon-lg text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
            </svg>
          </div>
          <div>
            <p class="text-2xl font-bold" id="stat-logins" data-testid="text-stat-logins">0</p>
            <p class="text-xs text-muted-foreground">Logins Hoje</p>
          </div>
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" id="tab-users" onclick="switchAdminTab('users')" data-testid="tab-users">Usuários</button>
        <button class="tab" id="tab-announcements" onclick="switchAdminTab('announcements')" data-testid="tab-announcements">Notícias</button>
        <button class="tab" id="tab-logs" onclick="switchAdminTab('logs')" data-testid="tab-logs">Logs</button>
        <button class="tab" id="tab-support" onclick="switchAdminTab('support')" data-testid="tab-support">Suporte</button>
      </div>

      <div id="admin-users" class="card p-4">
        <div class="flex items-center justify-between gap-2 mb-4 flex-wrap">
          <h2 class="text-lg font-bold">Gerenciamento de Usuários</h2>
          <button class="btn btn-ghost btn-sm" onclick="loadAdminData()" data-testid="button-refresh-users">
            <svg class="icon mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <polyline points="23 4 23 10 17 10"></polyline>
              <polyline points="1 20 1 14 7 14"></polyline>
              <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"></path>
            </svg>
            Atualizar
          </button>
        </div>
        <div class="overflow-x-auto">
          <table class="table">
            <thead>
              <tr>
                <th>Usuário</th>
                <th>Email</th>
                <th>Perfil</th>
                <th>Status</th>
                <th>Criado em</th>
                <th class="table-text-right">Ações</th>
              </tr>
            </thead>
            <tbody id="users-table-body"></tbody>
          </table>
        </div>
      </div>

      <div id="admin-announcements" class="hidden card p-4">
        <div class="flex items-center justify-between gap-2 mb-4 flex-wrap">
          <h2 class="text-lg font-bold">Gerenciamento de Notícias</h2>
          <button class="btn btn-primary btn-sm" onclick="showAnnouncementForm()" data-testid="button-new-announcement">
            <svg class="icon mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Nova Notícia
          </button>
        </div>

        <div id="announcement-form" class="hidden p-4 mb-4 rounded-lg" style="background-color: hsl(var(--muted));">
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-semibold" id="announcement-form-title">Nova Notícia</h3>
            <button class="btn btn-ghost btn-icon" onclick="hideAnnouncementForm()">
              <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <div class="space-y-4">
            <div class="space-y-2">
              <label class="label">Título</label>
              <input type="text" id="announcement-title" class="input input-h-11" placeholder="Título da notícia" data-testid="input-announcement-title">
            </div>
            <div class="space-y-2">
              <label class="label">Conteúdo</label>
              <textarea id="announcement-content" class="textarea" placeholder="Conteúdo da notícia" rows="4" data-testid="input-announcement-content"></textarea>
            </div>
            <div class="flex justify-end gap-2">
              <button class="btn btn-ghost" onclick="hideAnnouncementForm()">Cancelar</button>
              <button class="btn btn-primary" onclick="saveAnnouncement()" data-testid="button-save-announcement">Salvar</button>
            </div>
          </div>
        </div>

        <div class="space-y-4" id="announcements-admin-list"></div>
      </div>

      <div id="admin-logs" class="hidden card p-4">
        <div class="flex items-center justify-between gap-2 mb-4 flex-wrap">
          <h2 class="text-lg font-bold">Histórico de Logins</h2>
          <button class="btn btn-ghost btn-sm" onclick="loadAdminData()">
            <svg class="icon mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <polyline points="23 4 23 10 17 10"></polyline>
              <polyline points="1 20 1 14 7 14"></polyline>
              <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"></path>
            </svg>
            Atualizar
          </button>
        </div>
        <div class="overflow-x-auto">
          <table class="table">
            <thead>
              <tr>
                <th>Status</th>
                <th>Email/Usuário</th>
                <th>IP</th>
                <th>Data/Hora</th>
              </tr>
            </thead>
            <tbody id="logs-table-body"></tbody>
          </table>
        </div>
      </div>

      <div id="admin-support" class="hidden card p-4">
        <div class="flex items-center justify-between gap-2 mb-4 flex-wrap">
          <h2 class="text-lg font-bold">Tickets de Suporte</h2>
        </div>
        <div class="space-y-4" id="support-tickets-list">
          <p class="text-muted-foreground text-center py-8">Nenhum ticket de suporte pendente.</p>
        </div>
      </div>
    </main>
  </div>

  <!-- PROJECTOR CONTROL PAGE -->
  <div id="projector-control-page" class="hidden min-h-screen bg-background">
    <div class="flex h-screen">
      <!-- Sidebar -->
      <div class="sidebar hidden md:flex" id="control-sidebar">
        <div class="sidebar-header">
          <div class="flex items-center justify-between mb-2">
            <div>
              <h2 class="font-bold text-lg">Sistema de Projeção</h2>
              <p class="text-xs text-muted-foreground">Equipe da Mídia</p>
            </div>
          </div>
          
          <!-- Live indicator -->
          <div id="live-banner" class="hidden w-full py-1 px-2 bg-destructive rounded-md mb-2">
            <div class="flex items-center justify-center gap-1">
              <div class="w-1.5 h-1.5 bg-white rounded-full animate-pulse"></div>
              <span class="text-white font-semibold text-xs">AO VIVO</span>
            </div>
          </div>

          <!-- Clock -->
          <p class="text-3xl font-bold text-foreground tabular-nums tracking-wider text-center" id="clock-display">00:00:00</p>
        </div>
        
        <div class="sidebar-content space-y-4">
          <!-- Live Preview -->
          <div class="space-y-2">
            <h3 class="text-xs font-medium text-muted-foreground flex items-center gap-1.5">
              <div class="w-1.5 h-1.5 bg-destructive rounded-full animate-pulse"></div>
              TELÃO AO VIVO
            </h3>
            <div class="live-preview" id="live-preview">
              <div class="live-preview-content" id="live-preview-content">
                <p class="text-lg font-bold">EQUIPE DA MÍDIA</p>
                <p class="text-sm opacity-70">MODO ESPERA</p>
              </div>
            </div>
            
            <!-- Projector controls -->
            <div class="flex items-center justify-center gap-2 pt-1">
              <button class="btn btn-icon btn-outline" id="btn-toggle-projector" onclick="toggleProjectorWindow()" data-testid="button-toggle-projector" title="Abrir/Fechar Telão">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                  <line x1="8" y1="21" x2="16" y2="21"></line>
                  <line x1="12" y1="17" x2="12" y2="21"></line>
                </svg>
              </button>
              <button class="btn btn-icon btn-outline" id="btn-dark-screen" onclick="toggleDarkScreen()" data-testid="button-dark-screen" title="Modo de Espera">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
              </button>
              <button class="btn btn-icon btn-outline" id="btn-black-screen" onclick="toggleBlackScreen()" data-testid="button-black-screen" title="Tela Preta">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                </svg>
              </button>
              <button class="btn btn-icon btn-outline" id="btn-pause-transmission" onclick="togglePauseTransmission()" data-testid="button-pause-transmission" title="Pausar Transmissão">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="10" y1="15" x2="10" y2="9"></line>
                  <line x1="14" y1="15" x2="14" y2="9"></line>
                </svg>
              </button>
            </div>
          </div>

          <div class="separator"></div>

          <!-- Presentation controls -->
          <div class="space-y-2">
            <h3 class="font-semibold text-sm">Apresentação</h3>
            <button class="btn btn-full heartbeat-button" id="btn-toggle-live" onclick="toggleLive()" data-testid="button-toggle-live" style="background-color: #22c55e; color: white;">
              <svg class="icon mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <circle cx="12" cy="12" r="4" fill="currentColor"></circle>
              </svg>
              Iniciar Apresentação
            </button>
          </div>

          <div class="separator"></div>

          <!-- Playback controls -->
          <div class="space-y-2">
            <h3 class="font-semibold text-sm">Slides e texto</h3>
            <button class="btn btn-primary btn-full" id="btn-play-pause" onclick="toggleAutoPlay()" data-testid="button-play-pause">
              <svg class="icon mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" id="play-pause-icon">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
              </svg>
              <span id="play-pause-text">Reproduzir</span>
            </button>
            <button class="btn btn-outline btn-full" id="btn-repeat-all" onclick="toggleRepeatAll()" data-testid="button-repeat-all">
              <svg class="icon mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="17 1 21 5 17 9"></polyline>
                <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
                <polyline points="7 23 3 19 7 15"></polyline>
                <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
              </svg>
              Repetir tudo
            </button>
          </div>

          <div class="separator"></div>

          <!-- Volume -->
          <div class="space-y-2">
            <h3 class="font-semibold text-sm">Volume</h3>
            <div class="flex items-center gap-3">
              <button class="btn btn-ghost btn-icon" onclick="toggleMute()" data-testid="button-mute" id="btn-mute">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" id="volume-icon">
                  <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                  <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                </svg>
              </button>
              <input type="range" class="slider flex-1" min="0" max="100" value="80" id="volume-slider" data-testid="slider-volume" oninput="updateVolume(this.value)">
              <span class="text-sm text-muted-foreground w-10 text-right" id="volume-display">80%</span>
            </div>
          </div>

          <div class="separator"></div>

          <!-- Actions -->
          <div class="space-y-2">
            <h3 class="font-semibold text-sm">Ações</h3>
            <button class="btn btn-outline btn-full" onclick="importData()" data-testid="button-import">
              <svg class="icon mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
              Importar
            </button>
            <button class="btn btn-outline btn-full" onclick="exportData()" data-testid="button-export">
              <svg class="icon mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              Exportar
            </button>
            <button class="btn btn-outline btn-full" onclick="saveAllData()" data-testid="button-save">
              <svg class="icon mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
              </svg>
              Salvar Tudo
            </button>
          </div>
        </div>

        <div class="sidebar-footer space-y-2">
          <div class="flex items-center justify-between">
            <span class="text-xs font-semibold text-muted-foreground">EQUIPE DA MÍDIA</span>
            <div class="flex items-center gap-1">
              <button class="btn btn-ghost btn-icon" onclick="showHelpDialog()" data-testid="button-help">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                  <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
              </button>
              <button class="theme-toggle" onclick="toggleTheme()">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="5"></circle>
                  <line x1="12" y1="1" x2="12" y2="3"></line>
                  <line x1="12" y1="21" x2="12" y2="23"></line>
                  <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                  <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                  <line x1="1" y1="12" x2="3" y2="12"></line>
                  <line x1="21" y1="12" x2="23" y2="12"></line>
                  <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                  <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
              </button>
            </div>
          </div>
          <button class="btn btn-outline btn-full" onclick="showPage('user-home')" data-testid="button-back-home">
            <svg class="icon mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            Voltar
          </button>
        </div>
      </div>

      <!-- Main Content -->
      <div class="flex-1 flex flex-col overflow-hidden">
        <!-- Header -->
        <header class="flex items-center justify-between p-3 border-b gap-2">
          <div class="flex items-center gap-4">
            <button class="btn btn-ghost btn-icon md:hidden" onclick="toggleMobileSidebar()" data-testid="button-menu">
              <svg class="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
              </svg>
            </button>
            <button class="btn btn-ghost btn-icon" onclick="previousSlide()" data-testid="button-previous-slide">
              <svg class="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="19 12 5 12"></polyline>
                <polyline points="12 19 5 12 12 5"></polyline>
              </svg>
            </button>
            <span id="slide-counter" class="text-sm text-muted-foreground tabular-nums" data-testid="text-slide-counter">0 / 0</span>
            <button class="btn btn-ghost btn-icon" onclick="nextSlide()" data-testid="button-next-slide">
              <svg class="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="5 12 19 12"></polyline>
                <polyline points="12 5 19 12 12 19"></polyline>
              </svg>
            </button>
          </div>
          <div class="flex items-center gap-2">
            <button class="btn btn-primary btn-sm hidden md:flex" id="btn-send-to-projector" onclick="sendToProjector()" data-testid="button-send-to-projector">
              <svg class="icon mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"></path>
              </svg>
              Enviar
            </button>
          </div>
        </header>

        <!-- Main Area -->
        <main class="flex-1 overflow-y-auto p-4 md:p-6">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
            <!-- Left Column - Preview and Upload -->
            <div class="flex flex-col gap-4">
              <!-- Preview -->
              <div>
                <h2 class="text-lg font-semibold mb-2">Prévia da apresentação</h2>
                <div class="preview-container" id="preview-container">
                  <div class="preview-content" id="preview-content">
                    <p class="text-2xl font-bold mb-2">EQUIPE DA MÍDIA</p>
                    <p class="text-lg opacity-70">MODO ESPERA - AGUARDANDO CONTEÚDO</p>
                  </div>
                </div>
              </div>

              <!-- Upload Buttons -->
              <div class="flex flex-wrap gap-2">
                <button class="btn btn-primary" onclick="openMediaUpload()" data-testid="button-upload-media">
                  <svg class="icon mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                  </svg>
                  Adicionar Imagem/Vídeo
                </button>
                <button class="btn btn-outline" onclick="showTextSlideModal()" data-testid="button-add-text">
                  <svg class="icon mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <polyline points="4 7 4 4 20 4 20 7"></polyline>
                    <line x1="9" y1="20" x2="15" y2="20"></line>
                    <line x1="12" y1="4" x2="12" y2="20"></line>
                  </svg>
                  Adicionar Texto
                </button>
              </div>

              <!-- Settings Tabs -->
              <div class="card">
                <div class="tabs">
                  <button class="tab active" onclick="switchSettingsTab('image')" id="settings-tab-image">Imagem</button>
                  <button class="tab" onclick="switchSettingsTab('slides')" id="settings-tab-slides">Slides</button>
                  <button class="tab" onclick="switchSettingsTab('messages')" id="settings-tab-messages">Espera</button>
                </div>
                <div class="p-4">
                  <!-- Image Settings -->
                  <div id="settings-image" class="space-y-4">
                    <div class="space-y-2">
                      <label class="label">Ajuste de imagem</label>
                      <select class="select" id="fit-mode-select" onchange="updateFitMode(this.value)">
                        <option value="contain">Ajustar (preservar proporção)</option>
                        <option value="cover">Preencher (cortar bordas)</option>
                        <option value="fill">Esticar (preencher tudo)</option>
                      </select>
                    </div>
                    <div class="space-y-2">
                      <label class="label">Zoom: <span id="zoom-value">100%</span></label>
                      <input type="range" class="slider w-full" min="50" max="200" value="100" id="zoom-slider" oninput="updateZoom(this.value)">
                    </div>
                    <button class="btn btn-outline btn-sm" onclick="resetImageSettings()">
                      <svg class="icon mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <polyline points="23 4 23 10 17 10"></polyline>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                      </svg>
                      Resetar
                    </button>
                  </div>

                  <!-- Slides Settings -->
                  <div id="settings-slides" class="hidden space-y-4">
                    <div class="space-y-2">
                      <label class="label">Duração dos slides (segundos)</label>
                      <input type="number" class="input" id="slide-duration" min="1" max="300" value="5" oninput="updateSlideDuration(this.value)">
                    </div>
                    <div class="space-y-2">
                      <label class="label">Tamanho do texto: <span id="font-size-value">48px</span></label>
                      <input type="range" class="slider w-full" min="16" max="120" value="48" id="font-size-slider" oninput="updateFontSize(this.value)">
                    </div>
                  </div>

                  <!-- Waiting Messages -->
                  <div id="settings-messages" class="hidden space-y-4">
                    <div class="space-y-2">
                      <label class="label">Título da Mensagem</label>
                      <input type="text" class="input" id="waiting-title" placeholder="EQUIPE DA MÍDIA" oninput="updateWaitingMessage()">
                    </div>
                    <div class="space-y-2">
                      <label class="label">Subtítulo da Mensagem</label>
                      <input type="text" class="input" id="waiting-subtitle" placeholder="MODO ESPERA - AGUARDANDO CONTEÚDO" oninput="updateWaitingMessage()">
                    </div>
                    <p class="text-xs text-muted-foreground">
                      Essas mensagens aparecem no telão quando está em modo de espera.
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Right Column - Playlist and Gallery -->
            <div class="flex flex-col">
              <div class="card flex-1">
                <div class="tabs">
                  <button class="tab active" onclick="switchMediaTab('playlist')" id="media-tab-playlist" data-testid="tab-playlist">
                    Lista (<span id="playlist-count">0</span>)
                  </button>
                  <button class="tab" onclick="switchMediaTab('gallery')" id="media-tab-gallery" data-testid="tab-gallery">
                    Galeria (<span id="gallery-count">0</span>)
                  </button>
                </div>

                <!-- Playlist Panel -->
                <div id="panel-playlist" class="p-4">
                  <div class="flex items-center justify-between mb-2">
                    <h3 class="text-sm font-semibold text-muted-foreground">ITENS PARA O CULTO</h3>
                    <button class="btn btn-ghost btn-sm" onclick="clearPlaylist()" data-testid="button-clear-playlist" id="btn-clear-playlist">
                      Limpar Lista
                    </button>
                  </div>
                  <div class="space-y-2 scroll-area" id="playlist-items" style="max-height: 400px;">
                    <div class="empty-state" id="playlist-empty">
                      <svg class="empty-state-icon text-muted-foreground mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                      </svg>
                      <p>Nenhum item na lista</p>
                      <p class="text-sm mt-2">Adicione itens da galeria ou faça upload</p>
                    </div>
                  </div>
                </div>

                <!-- Gallery Panel -->
                <div id="panel-gallery" class="hidden p-4">
                  <div class="flex items-center justify-between mb-2">
                    <h3 class="text-sm font-semibold text-muted-foreground">MÍDIA PERMANENTE</h3>
                  </div>
                  <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 scroll-area" id="gallery-items" style="max-height: 400px;">
                    <div class="empty-state col-span-full" id="gallery-empty">
                      <svg class="empty-state-icon text-muted-foreground mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <polyline points="21 15 16 10 5 21"></polyline>
                      </svg>
                      <p>Nenhum item na galeria</p>
                      <p class="text-sm mt-2">Use o botão de upload para adicionar mídia</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
  </div>

  <!-- PROJECTOR VIEW (Popup Window Content) -->
  <div id="projector-view" class="hidden projector-screen">
    <div id="projector-content-wrapper" class="w-full h-full">
      <div id="projector-waiting" class="projector-content">
        <p class="projector-text" id="projector-title">EQUIPE DA MÍDIA</p>
        <p class="projector-subtitle" id="projector-subtitle">MODO ESPERA - AGUARDANDO CONTEÚDO</p>
      </div>
      <img id="projector-image" class="hidden projector-media" src="" alt="">
      <video id="projector-video" class="hidden projector-media" autoplay></video>
      <div id="projector-text-slide" class="hidden w-full h-full flex items-center justify-center"></div>
    </div>
    <div id="projector-logo" class="hidden absolute bottom-4 right-4">
      <img id="logo-image" src="" alt="Logo" style="max-width: 120px; max-height: 80px; opacity: 0.8;">
    </div>
  </div>

  <!-- TEXT SLIDE MODAL -->
  <div id="text-slide-modal" class="hidden">
    <div class="dialog-overlay" onclick="hideTextSlideModal()"></div>
    <div class="dialog">
      <div class="dialog-header">
        <h2 class="dialog-title">Criar Slide de Texto</h2>
        <p class="dialog-description">Adicione texto para exibir no telão</p>
      </div>
      <div class="dialog-content space-y-4">
        <div class="space-y-2">
          <label class="label" for="text-slide-title">Título (opcional)</label>
          <input type="text" id="text-slide-title" class="input" placeholder="Título do slide">
        </div>
        <div class="space-y-2">
          <label class="label" for="text-slide-content">Conteúdo</label>
          <textarea id="text-slide-content" class="textarea" placeholder="Digite o texto do slide" rows="6"></textarea>
        </div>
      </div>
      <div class="dialog-footer">
        <button class="btn btn-ghost" onclick="hideTextSlideModal()">Cancelar</button>
        <button class="btn btn-primary" onclick="createTextSlide()">Criar Slide</button>
      </div>
    </div>
  </div>

  <!-- HELP DIALOG -->
  <div id="help-dialog" class="hidden">
    <div class="dialog-overlay" onclick="hideHelpDialog()"></div>
    <div class="dialog">
      <div class="dialog-header">
        <h2 class="dialog-title">Atalhos de Teclado</h2>
        <button class="btn btn-ghost btn-icon dialog-close" onclick="hideHelpDialog()">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="dialog-content">
        <div class="space-y-3">
          <div class="flex justify-between py-2 border-b">
            <span class="text-muted-foreground">Próximo slide</span>
            <kbd class="px-2 py-1 bg-muted rounded text-xs font-mono">→</kbd>
          </div>
          <div class="flex justify-between py-2 border-b">
            <span class="text-muted-foreground">Slide anterior</span>
            <kbd class="px-2 py-1 bg-muted rounded text-xs font-mono">←</kbd>
          </div>
          <div class="flex justify-between py-2 border-b">
            <span class="text-muted-foreground">Iniciar apresentação</span>
            <kbd class="px-2 py-1 bg-muted rounded text-xs font-mono">F1</kbd>
          </div>
          <div class="flex justify-between py-2 border-b">
            <span class="text-muted-foreground">Parar apresentação</span>
            <kbd class="px-2 py-1 bg-muted rounded text-xs font-mono">F2</kbd>
          </div>
          <div class="flex justify-between py-2 border-b">
            <span class="text-muted-foreground">Tela cheia</span>
            <kbd class="px-2 py-1 bg-muted rounded text-xs font-mono">F11</kbd>
          </div>
          <div class="flex justify-between py-2">
            <span class="text-muted-foreground">Reproduzir/Pausar</span>
            <kbd class="px-2 py-1 bg-muted rounded text-xs font-mono">F9</kbd>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MOBILE SIDEBAR OVERLAY -->
  <div id="sidebar-overlay" class="hidden sidebar-overlay" onclick="toggleMobileSidebar()"></div>

  <!-- TOAST CONTAINER -->
  <div class="toast-container" id="toast-container"></div>

  <!-- HIDDEN FILE INPUTS -->
  <input type="file" id="media-upload" class="hidden" accept="image/*,video/*" multiple onchange="handleMediaUpload(this.files)">
  <input type="file" id="import-file" class="hidden" accept=".json" onchange="handleImport(this.files[0])">

  <script>
    // ============================================
    // INDEXEDDB DATABASE MANAGER
    // ============================================
    const DB_NAME = 'EquipeMidiaDB';
    const DB_VERSION = 2;
    let dbInstance = null;

    async function initDatabase() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);
        
        request.onerror = () => reject(request.error);
        request.onsuccess = () => {
          dbInstance = request.result;
          resolve(dbInstance);
        };
        
        request.onupgradeneeded = (event) => {
          const db = event.target.result;
          
          if (!db.objectStoreNames.contains('gallery')) {
            db.createObjectStore('gallery', { keyPath: 'id' });
          }
          if (!db.objectStoreNames.contains('playlist')) {
            db.createObjectStore('playlist', { keyPath: 'id' });
          }
          if (!db.objectStoreNames.contains('media')) {
            db.createObjectStore('media', { keyPath: 'id' });
          }
          if (!db.objectStoreNames.contains('settings')) {
            db.createObjectStore('settings', { keyPath: 'key' });
          }
          if (!db.objectStoreNames.contains('themes')) {
            db.createObjectStore('themes', { keyPath: 'id' });
          }
        };
      });
    }

    async function dbGetAll(storeName) {
      const db = dbInstance || await initDatabase();
      return new Promise((resolve, reject) => {
        const transaction = db.transaction(storeName, 'readonly');
        const store = transaction.objectStore(storeName);
        const request = store.getAll();
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
      });
    }

    async function dbGet(storeName, key) {
      const db = dbInstance || await initDatabase();
      return new Promise((resolve, reject) => {
        const transaction = db.transaction(storeName, 'readonly');
        const store = transaction.objectStore(storeName);
        const request = store.get(key);
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
      });
    }

    async function dbPut(storeName, data) {
      const db = dbInstance || await initDatabase();
      return new Promise((resolve, reject) => {
        const transaction = db.transaction(storeName, 'readwrite');
        const store = transaction.objectStore(storeName);
        const request = store.put(data);
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
      });
    }

    async function dbDelete(storeName, key) {
      const db = dbInstance || await initDatabase();
      return new Promise((resolve, reject) => {
        const transaction = db.transaction(storeName, 'readwrite');
        const store = transaction.objectStore(storeName);
        const request = store.delete(key);
        request.onsuccess = () => resolve();
        request.onerror = () => reject(request.error);
      });
    }

    async function dbClear(storeName) {
      const db = dbInstance || await initDatabase();
      return new Promise((resolve, reject) => {
        const transaction = db.transaction(storeName, 'readwrite');
        const store = transaction.objectStore(storeName);
        const request = store.clear();
        request.onsuccess = () => resolve();
        request.onerror = () => reject(request.error);
      });
    }

    // ============================================
    // BROADCAST CHANNEL FOR PROJECTOR SYNC
    // ============================================
    let projectorChannel = null;
    try {
      projectorChannel = new BroadcastChannel('projector-sync');
    } catch (e) {
      console.log('BroadcastChannel not supported');
    }

    function broadcastToProjector(data) {
      if (projectorChannel) {
        projectorChannel.postMessage(data);
      }
      if (projectorWindow && !projectorWindow.closed) {
        projectorWindow.postMessage(data, '*');
      }
    }

    // ============================================
    // APP STATE
    // ============================================
    let currentUser = null;
    let currentTheme = localStorage.getItem('theme') || 'light';
    let currentPage = 'login';
    let featureIndex = 0;
    let projectorWindow = null;

    // Projector state
    let galleryItems = [];
    let playlistItems = [];
    let currentSlideIndex = 0;
    let isLive = false;
    let isPlaying = false;
    let repeatAll = false;
    let darkScreen = false;
    let blackScreen = false;
    let transmissionPaused = false;
    let isMuted = false;
    let volume = 80;
    let slideDuration = 5;
    let fontSize = 48;
    let fitMode = 'contain';
    let zoom = 100;
    let waitingTitle = 'EQUIPE DA MÍDIA';
    let waitingSubtitle = 'MODO ESPERA - AGUARDANDO CONTEÚDO';
    let autoPlayTimer = null;

    const features = [
      { icon: 'projector', title: 'Controle do Projetor', description: 'Gerencie apresentações em tempo real', color: '#3b82f6' },
      { icon: 'image', title: 'Galeria de Mídia', description: 'Organize imagens e vídeos', color: '#22c55e' },
      { icon: 'list', title: 'Playlists', description: 'Crie listas para apresentações', color: '#a855f7' },
      { icon: 'palette', title: 'Personalização', description: 'Configure temas e estilos', color: '#f97316' }
    ];

    // ============================================
    // INITIALIZATION
    // ============================================
    document.addEventListener('DOMContentLoaded', async () => {
      await initDatabase();
      applyTheme(currentTheme);
      checkAuth();
      startFeatureCarousel();
      setupFormHandlers();
      setupKeyboardShortcuts();
      startClock();
      await loadSavedData();
      
      const savedChurchName = localStorage.getItem('churchName');
      if (savedChurchName) {
        document.getElementById('church-name-display').textContent = savedChurchName;
      }
    });

    async function loadSavedData() {
      try {
        // Load settings
        const settings = await dbGet('settings', 'appSettings');
        if (settings) {
          volume = settings.volume || 80;
          slideDuration = settings.slideDuration || 5;
          fontSize = settings.fontSize || 48;
          fitMode = settings.fitMode || 'contain';
          zoom = settings.zoom || 100;
          waitingTitle = settings.waitingTitle || 'EQUIPE DA MÍDIA';
          waitingSubtitle = settings.waitingSubtitle || 'MODO ESPERA - AGUARDANDO CONTEÚDO';
          
          document.getElementById('volume-slider').value = volume;
          document.getElementById('volume-display').textContent = volume + '%';
          document.getElementById('slide-duration').value = slideDuration;
          document.getElementById('font-size-slider').value = fontSize;
          document.getElementById('font-size-value').textContent = fontSize + 'px';
          document.getElementById('fit-mode-select').value = fitMode;
          document.getElementById('zoom-slider').value = zoom;
          document.getElementById('zoom-value').textContent = zoom + '%';
          document.getElementById('waiting-title').value = waitingTitle;
          document.getElementById('waiting-subtitle').value = waitingSubtitle;
        }
        
        // Load gallery
        galleryItems = await dbGetAll('gallery');
        renderGallery();
        
        // Load playlist
        playlistItems = await dbGetAll('playlist');
        playlistItems.sort((a, b) => a.order - b.order);
        renderPlaylist();
        
      } catch (error) {
        console.error('Error loading saved data:', error);
      }
    }

    // ============================================
    // THEME MANAGEMENT
    // ============================================
    function toggleTheme() {
      currentTheme = currentTheme === 'light' ? 'dark' : 'light';
      localStorage.setItem('theme', currentTheme);
      applyTheme(currentTheme);
    }

    function applyTheme(theme) {
      document.documentElement.classList.toggle('dark', theme === 'dark');
    }

    // ============================================
    // PAGE NAVIGATION
    // ============================================
    function showPage(pageName) {
      const pages = ['loading-screen', 'login-page', 'register-page', 'forgot-password-page', 'user-home-page', 'admin-page', 'projector-control-page', 'projector-view'];
      pages.forEach(page => {
        const el = document.getElementById(page);
        if (el) el.classList.add('hidden');
      });

      const targetPage = document.getElementById(pageName + '-page') || document.getElementById(pageName);
      if (targetPage) {
        targetPage.classList.remove('hidden');
        currentPage = pageName;
      }

      if (pageName === 'user-home') {
        updateUserHome();
      } else if (pageName === 'admin') {
        loadAdminData();
      } else if (pageName === 'projector-control') {
        renderPlaylist();
        renderGallery();
      }
    }

    // ============================================
    // AUTHENTICATION
    // ============================================
    function checkAuth() {
      const user = localStorage.getItem('user');
      if (user) {
        currentUser = JSON.parse(user);
        if (currentUser.role === 'admin') {
          showPage('admin');
        } else {
          showPage('user-home');
        }
      } else {
        showPage('login');
      }
    }

    function logout() {
      localStorage.removeItem('user');
      localStorage.removeItem('token');
      currentUser = null;
      showToast('Desconectado', 'Você foi desconectado com sucesso');
      showPage('login');
    }

    // ============================================
    // FORM HANDLERS
    // ============================================
    function setupFormHandlers() {
      document.getElementById('login-form').addEventListener('submit', handleLogin);
      document.getElementById('register-form').addEventListener('submit', handleRegister);
      document.getElementById('forgot-form-1').addEventListener('submit', handleForgotStep1);
      document.getElementById('forgot-form-2').addEventListener('submit', handleForgotStep2);
      document.getElementById('forgot-form-3').addEventListener('submit', handleForgotStep3);
      document.getElementById('register-phone').addEventListener('input', formatPhoneInput);
    }

    async function handleLogin(e) {
      e.preventDefault();
      const identifier = document.getElementById('login-identifier').value;
      const password = document.getElementById('login-password').value;

      showLoginLoading(true);
      hideError('login-error');

      setTimeout(() => {
        if (identifier && password.length >= 6) {
          const user = {
            id: 1,
            email: identifier.includes('@') ? identifier : identifier + '@example.com',
            username: identifier.includes('@') ? identifier.split('@')[0] : identifier,
            role: identifier === 'admin' ? 'admin' : 'user',
            createdAt: new Date().toISOString()
          };
          
          localStorage.setItem('user', JSON.stringify(user));
          currentUser = user;
          showToast('Login realizado', `Bem-vindo, ${user.username}!`);
          
          if (user.role === 'admin') {
            showPage('admin');
          } else {
            showPage('user-home');
          }
        } else {
          showError('login-error', 'Credenciais inválidas. Senha deve ter pelo menos 6 caracteres.');
        }
        showLoginLoading(false);
      }, 1000);
    }

    async function handleRegister(e) {
      e.preventDefault();
      const email = document.getElementById('register-email').value;
      const username = document.getElementById('register-username').value;
      const password = document.getElementById('register-password').value;
      const confirmPassword = document.getElementById('register-confirm-password').value;

      hideError('register-error');

      if (password !== confirmPassword) {
        showError('register-error', 'As senhas não coincidem');
        return;
      }

      if (password.length < 6) {
        showError('register-error', 'Senha deve ter pelo menos 6 caracteres');
        return;
      }

      showRegisterLoading(true);

      setTimeout(() => {
        const user = {
          id: Date.now(),
          email: email,
          username: username,
          role: 'user',
          createdAt: new Date().toISOString()
        };
        
        localStorage.setItem('user', JSON.stringify(user));
        currentUser = user;
        showToast('Conta criada', 'Bem-vindo ao sistema!');
        showPage('user-home');
        showRegisterLoading(false);
      }, 1000);
    }

    function handleForgotStep1(e) {
      e.preventDefault();
      const identifier = document.getElementById('forgot-identifier').value;
      if (identifier) {
        document.getElementById('forgot-q1-label').textContent = 'Qual o nome do seu primeiro animal de estimação?';
        document.getElementById('forgot-q2-label').textContent = 'Qual o modelo do seu primeiro carro?';
        document.getElementById('forgot-q3-label').textContent = 'Qual o nome do seu livro favorito?';
        forgotStep(2);
      }
    }

    function handleForgotStep2(e) {
      e.preventDefault();
      forgotStep(3);
    }

    function handleForgotStep3(e) {
      e.preventDefault();
      const newPassword = document.getElementById('new-password').value;
      const confirmPassword = document.getElementById('confirm-new-password').value;

      if (newPassword !== confirmPassword) {
        showError('forgot-error-3', 'As senhas não coincidem');
        return;
      }

      if (newPassword.length < 6) {
        showError('forgot-error-3', 'Senha deve ter pelo menos 6 caracteres');
        return;
      }

      forgotStep(4);
      showToast('Senha alterada', 'Sua senha foi redefinida com sucesso');
    }

    function forgotStep(step) {
      for (let i = 1; i <= 4; i++) {
        document.getElementById('forgot-step-' + i).classList.add('hidden');
      }
      document.getElementById('forgot-step-' + step).classList.remove('hidden');
    }

    // ============================================
    // UI HELPERS
    // ============================================
    function showLoginLoading(show) {
      document.getElementById('login-btn-text').classList.toggle('hidden', show);
      document.getElementById('login-btn-loading').classList.toggle('hidden', !show);
    }

    function showRegisterLoading(show) {
      document.getElementById('register-btn-text').classList.toggle('hidden', show);
      document.getElementById('register-btn-loading').classList.toggle('hidden', !show);
    }

    function showError(elementId, message) {
      const errorEl = document.getElementById(elementId);
      const textEl = document.getElementById(elementId + '-text');
      errorEl.classList.remove('hidden');
      if (textEl) textEl.textContent = message;
    }

    function hideError(elementId) {
      const el = document.getElementById(elementId);
      if (el) el.classList.add('hidden');
    }

    function togglePasswordVisibility(inputId, button) {
      const input = document.getElementById(inputId);
      input.type = input.type === 'password' ? 'text' : 'password';
    }

    function toggleSwitch(element) {
      element.classList.toggle('active');
    }

    function formatPhoneInput(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length <= 2) {
        e.target.value = value;
      } else if (value.length <= 7) {
        e.target.value = `(${value.slice(0, 2)}) ${value.slice(2)}`;
      } else if (value.length <= 11) {
        e.target.value = `(${value.slice(0, 2)}) ${value.slice(2, 7)}-${value.slice(7)}`;
      } else {
        e.target.value = `(${value.slice(0, 2)}) ${value.slice(2, 7)}-${value.slice(7, 11)}`;
      }
    }

    function updatePasswordStrength() {
      const password = document.getElementById('register-password').value;
      const container = document.getElementById('password-strength');
      const textEl = document.getElementById('strength-text');
      
      if (password.length === 0) {
        container.classList.add('hidden');
        return;
      }
      
      container.classList.remove('hidden');
      let level = 0;
      
      if (password.length >= 6) level = 1;
      if (password.length >= 8) level = 2;
      if (password.length >= 10 && /[A-Z]/.test(password) && /[0-9]/.test(password)) level = 3;
      if (password.length >= 10 && /[A-Z]/.test(password) && /[0-9]/.test(password) && /[^A-Za-z0-9]/.test(password)) level = 4;
      
      const texts = ['', 'Muito fraca', 'Fraca', 'Média', 'Forte'];
      textEl.textContent = texts[level];
      
      for (let i = 1; i <= 4; i++) {
        const bar = document.getElementById('strength-' + i);
        bar.className = 'password-strength-bar';
        if (i <= level) {
          bar.classList.add('active-' + level);
        }
      }
    }

    function showToast(title, description, variant = 'default') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = 'toast' + (variant === 'destructive' ? ' toast-destructive' : '');
      toast.innerHTML = `
        <div class="toast-title">${title}</div>
        <div class="toast-description">${description}</div>
      `;
      container.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // ============================================
    // USER HOME
    // ============================================
    function updateUserHome() {
      if (!currentUser) return;
      
      const hour = new Date().getHours();
      let greeting = 'Bom dia';
      if (hour >= 12 && hour < 18) greeting = 'Boa tarde';
      else if (hour >= 18 || hour < 5) greeting = 'Boa noite';
      
      document.getElementById('greeting-text').textContent = `${greeting}, ${currentUser.username}!`;
      
      const userInfo = document.getElementById('user-info');
      userInfo.innerHTML = `
        <div class="flex justify-between py-2 border-b">
          <span class="text-muted-foreground">Email</span>
          <span class="font-medium">${currentUser.email}</span>
        </div>
        <div class="flex justify-between py-2 border-b">
          <span class="text-muted-foreground">Usuário</span>
          <span class="font-medium">${currentUser.username}</span>
        </div>
        <div class="flex justify-between py-2 border-b">
          <span class="text-muted-foreground">Tipo</span>
          <span class="font-medium">${currentUser.role === 'admin' ? 'Administrador' : 'Usuário Regular'}</span>
        </div>
        <div class="flex justify-between py-2">
          <span class="text-muted-foreground">Membro desde</span>
          <span class="font-medium">${new Date(currentUser.createdAt).toLocaleDateString('pt-BR')}</span>
        </div>
      `;
    }

    function editChurchName() {
      const name = prompt('Nome da Igreja:', localStorage.getItem('churchName') || '');
      if (name) {
        localStorage.setItem('churchName', name);
        document.getElementById('church-name-display').textContent = name;
        showToast('Salvo', 'Nome da igreja atualizado');
      }
    }

    // ============================================
    // FEATURE CAROUSEL
    // ============================================
    function startFeatureCarousel() {
      updateFeature();
      setInterval(() => {
        featureIndex = (featureIndex + 1) % features.length;
        updateFeature();
      }, 3000);
    }

    function updateFeature() {
      const feature = features[featureIndex];
      document.getElementById('feature-title').textContent = feature.title;
      document.getElementById('feature-description').textContent = feature.description;
      document.getElementById('feature-icon-wrapper').style.backgroundColor = feature.color + '1a';
      document.getElementById('feature-icon').style.color = feature.color;
      
      const dotsContainer = document.getElementById('feature-dots');
      dotsContainer.innerHTML = features.map((_, i) => 
        `<button class="feature-dot ${i === featureIndex ? 'active' : ''}" onclick="setFeature(${i})"></button>`
      ).join('');
    }

    function setFeature(index) {
      featureIndex = index;
      updateFeature();
    }

    // ============================================
    // ADMIN DASHBOARD
    // ============================================
    function switchAdminTab(tab) {
      const tabs = ['users', 'announcements', 'logs', 'support'];
      tabs.forEach(t => {
        document.getElementById('tab-' + t).classList.remove('active');
        document.getElementById('admin-' + t).classList.add('hidden');
      });
      document.getElementById('tab-' + tab).classList.add('active');
      document.getElementById('admin-' + tab).classList.remove('hidden');
    }

    function loadAdminData() {
      const users = [
        { id: 1, username: 'admin', email: 'admin@example.com', role: 'admin', isBlocked: false, createdAt: new Date().toISOString() },
        { id: 2, username: 'usuario1', email: 'user1@example.com', role: 'user', isBlocked: false, createdAt: new Date().toISOString() },
        { id: 3, username: 'usuario2', email: 'user2@example.com', role: 'user', isBlocked: true, createdAt: new Date().toISOString() },
      ];
      
      document.getElementById('stat-users').textContent = users.length;
      document.getElementById('stat-admins').textContent = users.filter(u => u.role === 'admin').length;
      document.getElementById('stat-blocked').textContent = users.filter(u => u.isBlocked).length;
      document.getElementById('stat-logins').textContent = '5';
      
      renderUsersTable(users);
      renderLogsTable();
    }

    function renderUsersTable(users) {
      const tbody = document.getElementById('users-table-body');
      tbody.innerHTML = users.map(u => `
        <tr>
          <td class="font-medium">${u.username}</td>
          <td class="text-muted-foreground">${u.email}</td>
          <td><span class="badge ${u.role === 'admin' ? 'badge-default' : 'badge-secondary'}">${u.role === 'admin' ? 'Admin' : 'Usuário'}</span></td>
          <td><span class="badge ${u.isBlocked ? 'badge-destructive' : 'badge-success'}">${u.isBlocked ? 'Bloqueado' : 'Ativo'}</span></td>
          <td class="text-muted-foreground">${new Date(u.createdAt).toLocaleDateString('pt-BR')}</td>
          <td class="table-text-right">
            ${u.id !== currentUser?.id ? `
              <button class="btn btn-ghost btn-sm ${u.isBlocked ? 'text-green-500' : 'text-destructive'}" onclick="toggleUserBlock(${u.id}, ${u.isBlocked})">
                ${u.isBlocked ? 'Desbloquear' : 'Bloquear'}
              </button>
            ` : '<span class="text-xs text-muted-foreground">Você</span>'}
          </td>
        </tr>
      `).join('');
    }

    function renderLogsTable() {
      const tbody = document.getElementById('logs-table-body');
      const logs = [
        { success: true, identifier: 'admin@example.com', ip: '192.168.1.1', date: new Date().toISOString() },
        { success: true, identifier: 'user1@example.com', ip: '192.168.1.2', date: new Date(Date.now() - 3600000).toISOString() },
        { success: false, identifier: 'hacker@bad.com', ip: '10.0.0.1', date: new Date(Date.now() - 7200000).toISOString() },
      ];
      
      tbody.innerHTML = logs.map(l => `
        <tr>
          <td><span class="badge ${l.success ? 'badge-success' : 'badge-destructive'}">${l.success ? 'Sucesso' : 'Falhou'}</span></td>
          <td class="font-medium">${l.identifier}</td>
          <td class="text-muted-foreground">${l.ip}</td>
          <td class="text-muted-foreground">${new Date(l.date).toLocaleString('pt-BR')}</td>
        </tr>
      `).join('');
    }

    function toggleUserBlock(userId, isBlocked) {
      showToast('Atualizado', isBlocked ? 'Usuário desbloqueado' : 'Usuário bloqueado');
      loadAdminData();
    }

    function showAnnouncementForm() {
      document.getElementById('announcement-form').classList.remove('hidden');
      document.getElementById('announcement-form-title').textContent = 'Nova Notícia';
    }

    function hideAnnouncementForm() {
      document.getElementById('announcement-form').classList.add('hidden');
      document.getElementById('announcement-title').value = '';
      document.getElementById('announcement-content').value = '';
    }

    function saveAnnouncement() {
      const title = document.getElementById('announcement-title').value;
      const content = document.getElementById('announcement-content').value;
      
      if (!title || !content) {
        showToast('Erro', 'Preencha todos os campos', 'destructive');
        return;
      }
      
      showToast('Salvo', 'Notícia publicada com sucesso');
      hideAnnouncementForm();
    }

    // ============================================
    // CLOCK
    // ============================================
    function startClock() {
      function updateClock() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('pt-BR', {
          timeZone: 'America/Sao_Paulo',
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit'
        });
        const clockEl = document.getElementById('clock-display');
        if (clockEl) clockEl.textContent = timeString;
      }
      updateClock();
      setInterval(updateClock, 1000);
    }

    // ============================================
    // PROJECTOR CONTROL
    // ============================================
    function toggleProjectorWindow() {
      if (projectorWindow && !projectorWindow.closed) {
        projectorWindow.close();
        projectorWindow = null;
        document.getElementById('btn-toggle-projector').classList.remove('btn-primary');
        document.getElementById('btn-toggle-projector').classList.add('btn-outline');
      } else {
        projectorWindow = window.open('', 'Projector', 'width=1280,height=720,menubar=no,toolbar=no,location=no,status=no');
        if (projectorWindow) {
          projectorWindow.document.write(getProjectorHTML());
          projectorWindow.document.close();
          document.getElementById('btn-toggle-projector').classList.add('btn-primary');
          document.getElementById('btn-toggle-projector').classList.remove('btn-outline');
          updateProjector();
        }
      }
    }

    function getProjectorHTML() {
      return `
        <!DOCTYPE html>
        <html>
        <head>
          <title>Telão - Equipe da Mídia</title>
          <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body { 
              background: #000; 
              color: #fff; 
              font-family: system-ui, -apple-system, sans-serif;
              overflow: hidden;
            }
            .projector-screen { 
              width: 100vw; 
              height: 100vh; 
              display: flex; 
              align-items: center; 
              justify-content: center; 
              position: relative;
            }
            .waiting-content { text-align: center; }
            .waiting-title { font-size: 3rem; font-weight: 700; }
            .waiting-subtitle { font-size: 1.5rem; opacity: 0.7; margin-top: 1rem; }
            .media-content { width: 100%; height: 100%; }
            .media-content img, .media-content video { 
              width: 100%; 
              height: 100%; 
              object-fit: contain; 
            }
            .text-slide {
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
              width: 100%;
              height: 100%;
              padding: 2rem;
              text-align: center;
            }
            .text-slide-title { font-weight: 700; margin-bottom: 1rem; }
            .text-slide-body { line-height: 1.6; white-space: pre-wrap; }
            .hidden { display: none; }
            .dark-screen { 
              position: absolute; 
              inset: 0; 
              background: rgba(0,0,0,0.8); 
              display: flex; 
              align-items: center; 
              justify-content: center; 
            }
            .black-screen { position: absolute; inset: 0; background: #000; }
          </style>
        </head>
        <body>
          <div class="projector-screen" id="screen">
            <div class="waiting-content" id="waiting">
              <p class="waiting-title" id="title">EQUIPE DA MÍDIA</p>
              <p class="waiting-subtitle" id="subtitle">MODO ESPERA - AGUARDANDO CONTEÚDO</p>
            </div>
            <div class="media-content hidden" id="media">
              <img id="image" src="" alt="">
              <video id="video" autoplay></video>
            </div>
            <div class="text-slide hidden" id="textSlide"></div>
            <div class="dark-screen hidden" id="darkOverlay">
              <div class="waiting-content">
                <p class="waiting-title" id="darkTitle">EQUIPE DA MÍDIA</p>
                <p class="waiting-subtitle" id="darkSubtitle">MODO ESPERA</p>
              </div>
            </div>
            <div class="black-screen hidden" id="blackOverlay"></div>
          </div>
          <script>
            window.addEventListener('message', (e) => {
              const data = e.data;
              if (!data || !data.type) return;
              
              const waiting = document.getElementById('waiting');
              const media = document.getElementById('media');
              const textSlide = document.getElementById('textSlide');
              const image = document.getElementById('image');
              const video = document.getElementById('video');
              const darkOverlay = document.getElementById('darkOverlay');
              const blackOverlay = document.getElementById('blackOverlay');
              
              if (data.type === 'update') {
                // Handle overlays
                darkOverlay.classList.toggle('hidden', !data.darkScreen);
                blackOverlay.classList.toggle('hidden', !data.blackScreen);
                
                document.getElementById('title').textContent = data.waitingTitle || 'EQUIPE DA MÍDIA';
                document.getElementById('subtitle').textContent = data.waitingSubtitle || 'MODO ESPERA - AGUARDANDO CONTEÚDO';
                document.getElementById('darkTitle').textContent = data.waitingTitle || 'EQUIPE DA MÍDIA';
                document.getElementById('darkSubtitle').textContent = 'MODO ESPERA';
                
                if (data.item) {
                  waiting.classList.add('hidden');
                  
                  if (data.item.type === 'image') {
                    media.classList.remove('hidden');
                    textSlide.classList.add('hidden');
                    image.classList.remove('hidden');
                    video.classList.add('hidden');
                    image.src = data.item.url;
                    image.style.objectFit = data.fitMode || 'contain';
                    image.style.transform = 'scale(' + (data.zoom / 100) + ')';
                  } else if (data.item.type === 'video') {
                    media.classList.remove('hidden');
                    textSlide.classList.add('hidden');
                    image.classList.add('hidden');
                    video.classList.remove('hidden');
                    if (video.src !== data.item.url) {
                      video.src = data.item.url;
                    }
                    video.muted = data.muted;
                    video.volume = data.volume / 100;
                    video.style.objectFit = data.fitMode || 'contain';
                  } else if (data.item.type === 'text') {
                    media.classList.add('hidden');
                    textSlide.classList.remove('hidden');
                    textSlide.innerHTML = '<div class="text-slide-title" style="font-size: ' + (data.fontSize * 1.5) + 'px">' + (data.item.textTitle || '') + '</div><div class="text-slide-body" style="font-size: ' + data.fontSize + 'px">' + (data.item.textContent || '') + '</div>';
                  }
                } else {
                  waiting.classList.remove('hidden');
                  media.classList.add('hidden');
                  textSlide.classList.add('hidden');
                }
              }
            });
          <\/script>
        </body>
        </html>
      `;
    }

    function updateProjector() {
      const currentItem = playlistItems[currentSlideIndex] || null;
      
      broadcastToProjector({
        type: 'update',
        item: currentItem,
        darkScreen: darkScreen,
        blackScreen: blackScreen,
        fitMode: fitMode,
        zoom: zoom,
        fontSize: fontSize,
        volume: volume,
        muted: isMuted,
        waitingTitle: waitingTitle,
        waitingSubtitle: waitingSubtitle
      });
      
      updatePreview();
      updateLivePreview();
    }

    function updatePreview() {
      const container = document.getElementById('preview-content');
      const currentItem = playlistItems[currentSlideIndex];
      
      if (!currentItem) {
        container.innerHTML = `
          <p class="text-2xl font-bold mb-2">${waitingTitle}</p>
          <p class="text-lg opacity-70">${waitingSubtitle}</p>
        `;
        return;
      }
      
      if (currentItem.type === 'image') {
        container.innerHTML = `<img src="${currentItem.url}" style="width:100%;height:100%;object-fit:${fitMode};transform:scale(${zoom/100})" alt="">`;
      } else if (currentItem.type === 'video') {
        container.innerHTML = `<video src="${currentItem.url}" style="width:100%;height:100%;object-fit:${fitMode}" autoplay muted></video>`;
      } else if (currentItem.type === 'text') {
        container.innerHTML = `
          <div class="text-slide-content">
            <div class="text-slide-title" style="font-size: ${fontSize * 0.5}px">${currentItem.textTitle || ''}</div>
            <div class="text-slide-body" style="font-size: ${fontSize * 0.3}px">${currentItem.textContent || ''}</div>
          </div>
        `;
      }
    }

    function updateLivePreview() {
      const container = document.getElementById('live-preview-content');
      if (!container) return;
      
      if (blackScreen) {
        container.innerHTML = '';
        container.style.background = '#000';
        return;
      }
      
      if (darkScreen) {
        container.innerHTML = `
          <p class="text-sm font-bold">${waitingTitle}</p>
          <p class="text-xs opacity-70">MODO ESPERA</p>
        `;
        container.style.background = 'rgba(0,0,0,0.8)';
        return;
      }
      
      container.style.background = '#000';
      const currentItem = playlistItems[currentSlideIndex];
      
      if (!currentItem) {
        container.innerHTML = `
          <p class="text-sm font-bold">${waitingTitle}</p>
          <p class="text-xs opacity-70">${waitingSubtitle}</p>
        `;
        return;
      }
      
      if (currentItem.type === 'image') {
        container.innerHTML = `<img src="${currentItem.url}" style="width:100%;height:100%;object-fit:contain" alt="">`;
      } else if (currentItem.type === 'video') {
        container.innerHTML = `<video src="${currentItem.url}" style="width:100%;height:100%;object-fit:contain" autoplay muted loop></video>`;
      } else if (currentItem.type === 'text') {
        container.innerHTML = `<p class="text-xs p-2 text-center">${currentItem.textTitle || currentItem.textContent || ''}</p>`;
      }
    }

    function toggleLive() {
      isLive = !isLive;
      const btn = document.getElementById('btn-toggle-live');
      const banner = document.getElementById('live-banner');
      
      if (isLive) {
        btn.style.backgroundColor = '#ef4444';
        btn.innerHTML = `
          <svg class="icon mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <rect x="6" y="6" width="12" height="12"></rect>
          </svg>
          Encerrar Apresentação
        `;
        btn.classList.remove('heartbeat-button');
        banner.classList.remove('hidden');
        showToast('Ao Vivo', 'Apresentação iniciada');
        
        if (!projectorWindow || projectorWindow.closed) {
          toggleProjectorWindow();
        }
      } else {
        btn.style.backgroundColor = '#22c55e';
        btn.innerHTML = `
          <svg class="icon mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10"></circle>
            <circle cx="12" cy="12" r="4" fill="currentColor"></circle>
          </svg>
          Iniciar Apresentação
        `;
        btn.classList.add('heartbeat-button');
        banner.classList.add('hidden');
        showToast('Encerrado', 'Apresentação encerrada');
      }
    }

    function toggleDarkScreen() {
      darkScreen = !darkScreen;
      if (darkScreen) blackScreen = false;
      
      document.getElementById('btn-dark-screen').classList.toggle('btn-destructive', darkScreen);
      document.getElementById('btn-dark-screen').classList.toggle('btn-outline', !darkScreen);
      document.getElementById('btn-black-screen').classList.toggle('btn-destructive', blackScreen);
      document.getElementById('btn-black-screen').classList.toggle('btn-outline', !blackScreen);
      
      updateProjector();
    }

    function toggleBlackScreen() {
      blackScreen = !blackScreen;
      if (blackScreen) darkScreen = false;
      
      document.getElementById('btn-black-screen').classList.toggle('btn-destructive', blackScreen);
      document.getElementById('btn-black-screen').classList.toggle('btn-outline', !blackScreen);
      document.getElementById('btn-dark-screen').classList.toggle('btn-destructive', darkScreen);
      document.getElementById('btn-dark-screen').classList.toggle('btn-outline', !darkScreen);
      
      updateProjector();
    }

    function togglePauseTransmission() {
      transmissionPaused = !transmissionPaused;
      document.getElementById('btn-pause-transmission').classList.toggle('btn-destructive', transmissionPaused);
      document.getElementById('btn-pause-transmission').classList.toggle('btn-outline', !transmissionPaused);
      showToast(transmissionPaused ? 'Pausado' : 'Retomado', transmissionPaused ? 'Transmissão pausada' : 'Transmissão retomada');
    }

    function toggleAutoPlay() {
      isPlaying = !isPlaying;
      const btn = document.getElementById('btn-play-pause');
      const icon = document.getElementById('play-pause-icon');
      const text = document.getElementById('play-pause-text');
      
      if (isPlaying) {
        icon.innerHTML = '<rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect>';
        text.textContent = 'Pausar';
        startAutoPlay();
      } else {
        icon.innerHTML = '<polygon points="5 3 19 12 5 21 5 3"></polygon>';
        text.textContent = 'Reproduzir';
        stopAutoPlay();
      }
    }

    function startAutoPlay() {
      stopAutoPlay();
      autoPlayTimer = setInterval(() => {
        if (!transmissionPaused && playlistItems.length > 0) {
          nextSlide();
        }
      }, slideDuration * 1000);
    }

    function stopAutoPlay() {
      if (autoPlayTimer) {
        clearInterval(autoPlayTimer);
        autoPlayTimer = null;
      }
    }

    function toggleRepeatAll() {
      repeatAll = !repeatAll;
      document.getElementById('btn-repeat-all').classList.toggle('btn-primary', repeatAll);
      document.getElementById('btn-repeat-all').classList.toggle('btn-outline', !repeatAll);
    }

    function toggleMute() {
      isMuted = !isMuted;
      const icon = document.getElementById('volume-icon');
      const btn = document.getElementById('btn-mute');
      
      if (isMuted) {
        icon.innerHTML = '<polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line>';
        btn.classList.add('text-destructive');
      } else {
        icon.innerHTML = '<polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>';
        btn.classList.remove('text-destructive');
      }
      
      updateProjector();
    }

    function updateVolume(val) {
      volume = parseInt(val);
      document.getElementById('volume-display').textContent = volume + '%';
      updateProjector();
    }

    function previousSlide() {
      if (playlistItems.length === 0) return;
      
      currentSlideIndex--;
      if (currentSlideIndex < 0) {
        currentSlideIndex = repeatAll ? playlistItems.length - 1 : 0;
      }
      
      updateSlideCounter();
      updateProjector();
      highlightCurrentPlaylistItem();
    }

    function nextSlide() {
      if (playlistItems.length === 0) return;
      
      currentSlideIndex++;
      if (currentSlideIndex >= playlistItems.length) {
        currentSlideIndex = repeatAll ? 0 : playlistItems.length - 1;
      }
      
      updateSlideCounter();
      updateProjector();
      highlightCurrentPlaylistItem();
    }

    function updateSlideCounter() {
      document.getElementById('slide-counter').textContent = `${playlistItems.length > 0 ? currentSlideIndex + 1 : 0} / ${playlistItems.length}`;
    }

    function sendToProjector() {
      if (playlistItems.length === 0) {
        showToast('Lista vazia', 'Adicione itens à lista primeiro', 'destructive');
        return;
      }
      
      if (!projectorWindow || projectorWindow.closed) {
        toggleProjectorWindow();
      }
      
      if (!isLive) {
        toggleLive();
      }
      
      updateProjector();
      showToast('Enviado', 'Conteúdo enviado para o telão');
    }

    // ============================================
    // MEDIA MANAGEMENT
    // ============================================
    function openMediaUpload() {
      document.getElementById('media-upload').click();
    }

    async function handleMediaUpload(files) {
      for (const file of files) {
        const id = 'media-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        const type = file.type.startsWith('video') ? 'video' : 'image';
        const url = URL.createObjectURL(file);
        
        const item = {
          id: id,
          name: file.name,
          type: type,
          url: url,
          size: file.size,
          mimeType: file.type,
          createdAt: new Date().toISOString()
        };
        
        galleryItems.push(item);
        await dbPut('gallery', item);
        
        // Also save the blob for persistence
        await dbPut('media', { id: id, blob: file });
      }
      
      renderGallery();
      showToast('Upload completo', `${files.length} arquivo(s) adicionado(s)`);
    }

    function renderGallery() {
      const container = document.getElementById('gallery-items');
      const emptyEl = document.getElementById('gallery-empty');
      const countEl = document.getElementById('gallery-count');
      
      countEl.textContent = galleryItems.length;
      
      if (galleryItems.length === 0) {
        emptyEl.classList.remove('hidden');
        return;
      }
      
      emptyEl.classList.add('hidden');
      container.innerHTML = galleryItems.map(item => `
        <div class="gallery-item" data-id="${item.id}">
          ${item.type === 'image' ? 
            `<img src="${item.url}" alt="${item.name}">` : 
            item.type === 'video' ?
            `<video src="${item.url}" muted></video>` :
            `<div class="w-full h-full flex items-center justify-center p-2 text-xs text-center bg-gradient-to-br from-primary/20 to-primary/5">${item.textTitle || item.textContent || 'Texto'}</div>`
          }
          <div class="gallery-item-overlay">
            <button class="btn btn-sm btn-primary" onclick="addToPlaylist('${item.id}')" title="Adicionar à lista">
              <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </button>
            <button class="btn btn-sm btn-destructive ml-1" onclick="deleteFromGallery('${item.id}')" title="Excluir">
              <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
            </button>
          </div>
        </div>
      `).join('');
    }

    async function addToPlaylist(galleryId) {
      const galleryItem = galleryItems.find(g => g.id === galleryId);
      if (!galleryItem) return;
      
      const playlistId = 'playlist-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
      const playlistItem = {
        ...galleryItem,
        id: playlistId,
        galleryItemId: galleryId,
        order: playlistItems.length
      };
      
      playlistItems.push(playlistItem);
      await dbPut('playlist', playlistItem);
      
      renderPlaylist();
      updateSlideCounter();
      showToast('Adicionado', 'Item adicionado à lista');
    }

    async function deleteFromGallery(id) {
      const index = galleryItems.findIndex(g => g.id === id);
      if (index === -1) return;
      
      if (galleryItems[index].url) {
        URL.revokeObjectURL(galleryItems[index].url);
      }
      
      galleryItems.splice(index, 1);
      await dbDelete('gallery', id);
      await dbDelete('media', id);
      
      renderGallery();
      showToast('Excluído', 'Item removido da galeria');
    }

    function renderPlaylist() {
      const container = document.getElementById('playlist-items');
      const emptyEl = document.getElementById('playlist-empty');
      const countEl = document.getElementById('playlist-count');
      const clearBtn = document.getElementById('btn-clear-playlist');
      
      countEl.textContent = playlistItems.length;
      clearBtn.classList.toggle('hidden', playlistItems.length === 0);
      
      if (playlistItems.length === 0) {
        emptyEl.classList.remove('hidden');
        container.innerHTML = '';
        container.appendChild(emptyEl);
        return;
      }
      
      emptyEl.classList.add('hidden');
      container.innerHTML = playlistItems.map((item, index) => `
        <div class="playlist-item ${index === currentSlideIndex ? 'current' : ''}" data-id="${item.id}" data-index="${index}">
          <div class="playlist-item-grip">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <circle cx="9" cy="5" r="1"></circle>
              <circle cx="9" cy="12" r="1"></circle>
              <circle cx="9" cy="19" r="1"></circle>
              <circle cx="15" cy="5" r="1"></circle>
              <circle cx="15" cy="12" r="1"></circle>
              <circle cx="15" cy="19" r="1"></circle>
            </svg>
          </div>
          <div class="playlist-item-thumbnail">
            ${item.type === 'image' ? 
              `<img src="${item.url}" alt="">` : 
              item.type === 'video' ?
              `<video src="${item.url}" muted></video>` :
              `<div class="w-full h-full flex items-center justify-center bg-primary/10 text-xs">T</div>`
            }
          </div>
          <div class="playlist-item-info">
            <p class="playlist-item-name">${item.name || item.textTitle || 'Slide de texto'}</p>
            <p class="playlist-item-type">${item.type === 'image' ? 'Imagem' : item.type === 'video' ? 'Vídeo' : 'Texto'}</p>
          </div>
          <div class="playlist-item-actions">
            <button class="btn btn-ghost btn-icon" onclick="playItem(${index})" title="Exibir">
              <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
              </svg>
            </button>
            <button class="btn btn-ghost btn-icon" onclick="deleteFromPlaylist('${item.id}')" title="Remover">
              <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
        </div>
      `).join('');
    }

    function playItem(index) {
      currentSlideIndex = index;
      updateSlideCounter();
      updateProjector();
      highlightCurrentPlaylistItem();
    }

    function highlightCurrentPlaylistItem() {
      document.querySelectorAll('.playlist-item').forEach((el, i) => {
        el.classList.toggle('current', i === currentSlideIndex);
      });
    }

    async function deleteFromPlaylist(id) {
      const index = playlistItems.findIndex(p => p.id === id);
      if (index === -1) return;
      
      playlistItems.splice(index, 1);
      await dbDelete('playlist', id);
      
      // Reorder remaining items
      playlistItems.forEach((item, i) => {
        item.order = i;
        dbPut('playlist', item);
      });
      
      if (currentSlideIndex >= playlistItems.length) {
        currentSlideIndex = Math.max(0, playlistItems.length - 1);
      }
      
      renderPlaylist();
      updateSlideCounter();
      updateProjector();
    }

    async function clearPlaylist() {
      if (!confirm('Tem certeza que deseja limpar toda a lista?')) return;
      
      playlistItems = [];
      await dbClear('playlist');
      currentSlideIndex = 0;
      
      renderPlaylist();
      updateSlideCounter();
      updateProjector();
      showToast('Lista limpa', 'Todos os itens foram removidos');
    }

    // ============================================
    // TEXT SLIDES
    // ============================================
    function showTextSlideModal() {
      document.getElementById('text-slide-modal').classList.remove('hidden');
    }

    function hideTextSlideModal() {
      document.getElementById('text-slide-modal').classList.add('hidden');
      document.getElementById('text-slide-title').value = '';
      document.getElementById('text-slide-content').value = '';
    }

    async function createTextSlide() {
      const title = document.getElementById('text-slide-title').value;
      const content = document.getElementById('text-slide-content').value;
      
      if (!content && !title) {
        showToast('Erro', 'Digite algum conteúdo', 'destructive');
        return;
      }
      
      const id = 'text-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
      const item = {
        id: id,
        name: title || 'Slide de texto',
        type: 'text',
        textTitle: title,
        textContent: content,
        createdAt: new Date().toISOString()
      };
      
      galleryItems.push(item);
      await dbPut('gallery', item);
      
      // Also add to playlist
      const playlistId = 'playlist-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
      const playlistItem = {
        ...item,
        id: playlistId,
        galleryItemId: id,
        order: playlistItems.length
      };
      
      playlistItems.push(playlistItem);
      await dbPut('playlist', playlistItem);
      
      renderGallery();
      renderPlaylist();
      updateSlideCounter();
      hideTextSlideModal();
      showToast('Criado', 'Slide de texto criado e adicionado à lista');
    }

    // ============================================
    // SETTINGS
    // ============================================
    function switchSettingsTab(tab) {
      const tabs = ['image', 'slides', 'messages'];
      tabs.forEach(t => {
        document.getElementById('settings-tab-' + t).classList.remove('active');
        document.getElementById('settings-' + t).classList.add('hidden');
      });
      document.getElementById('settings-tab-' + tab).classList.add('active');
      document.getElementById('settings-' + tab).classList.remove('hidden');
    }

    function switchMediaTab(tab) {
      const tabs = ['playlist', 'gallery'];
      tabs.forEach(t => {
        document.getElementById('media-tab-' + t).classList.remove('active');
        document.getElementById('panel-' + t).classList.add('hidden');
      });
      document.getElementById('media-tab-' + tab).classList.add('active');
      document.getElementById('panel-' + tab).classList.remove('hidden');
    }

    function updateFitMode(val) {
      fitMode = val;
      updateProjector();
    }

    function updateZoom(val) {
      zoom = parseInt(val);
      document.getElementById('zoom-value').textContent = zoom + '%';
      updateProjector();
    }

    function resetImageSettings() {
      fitMode = 'contain';
      zoom = 100;
      document.getElementById('fit-mode-select').value = 'contain';
      document.getElementById('zoom-slider').value = 100;
      document.getElementById('zoom-value').textContent = '100%';
      updateProjector();
    }

    function updateSlideDuration(val) {
      slideDuration = parseInt(val) || 5;
      if (isPlaying) {
        startAutoPlay();
      }
    }

    function updateFontSize(val) {
      fontSize = parseInt(val);
      document.getElementById('font-size-value').textContent = fontSize + 'px';
      updateProjector();
    }

    function updateWaitingMessage() {
      waitingTitle = document.getElementById('waiting-title').value || 'EQUIPE DA MÍDIA';
      waitingSubtitle = document.getElementById('waiting-subtitle').value || 'MODO ESPERA - AGUARDANDO CONTEÚDO';
      updateProjector();
    }

    // ============================================
    // IMPORT/EXPORT
    // ============================================
    function importData() {
      document.getElementById('import-file').click();
    }

    async function handleImport(file) {
      if (!file) return;
      
      try {
        const text = await file.text();
        const data = JSON.parse(text);
        
        if (data.galleryItems) {
          for (const item of data.galleryItems) {
            if (item.blobData) {
              const blob = dataURLtoBlob(item.blobData);
              item.url = URL.createObjectURL(blob);
              await dbPut('media', { id: item.id, blob: blob });
            }
            galleryItems.push(item);
            await dbPut('gallery', item);
          }
        }
        
        if (data.playlistItems) {
          playlistItems = data.playlistItems;
          for (const item of playlistItems) {
            const galleryItem = galleryItems.find(g => g.id === item.galleryItemId);
            if (galleryItem) {
              item.url = galleryItem.url;
            }
            await dbPut('playlist', item);
          }
        }
        
        if (data.settings) {
          Object.assign(this, data.settings);
          await dbPut('settings', { key: 'appSettings', ...data.settings });
        }
        
        renderGallery();
        renderPlaylist();
        updateSlideCounter();
        showToast('Importado', 'Dados importados com sucesso');
        
      } catch (error) {
        console.error('Import error:', error);
        showToast('Erro', 'Arquivo inválido ou corrompido', 'destructive');
      }
    }

    function dataURLtoBlob(dataURL) {
      const [header, base64Data] = dataURL.split(',');
      const mimeMatch = header.match(/data:([^;]+);/);
      const mimeType = mimeMatch ? mimeMatch[1] : 'application/octet-stream';
      const binaryString = atob(base64Data);
      const bytes = new Uint8Array(binaryString.length);
      for (let i = 0; i < binaryString.length; i++) {
        bytes[i] = binaryString.charCodeAt(i);
      }
      return new Blob([bytes], { type: mimeType });
    }

    async function exportData() {
      try {
        const galleryWithBlobs = await Promise.all(
          galleryItems.map(async (item) => {
            let blobData = null;
            if (item.type !== 'text') {
              const mediaData = await dbGet('media', item.id);
              if (mediaData && mediaData.blob) {
                const arrayBuffer = await mediaData.blob.arrayBuffer();
                const base64 = btoa(
                  new Uint8Array(arrayBuffer).reduce((data, byte) => data + String.fromCharCode(byte), '')
                );
                blobData = `data:${mediaData.blob.type};base64,${base64}`;
              }
            }
            const { url, ...cleanItem } = item;
            return { ...cleanItem, blobData };
          })
        );
        
        const exportObj = {
          version: 1,
          galleryItems: galleryWithBlobs,
          playlistItems: playlistItems.map(({ url, ...item }) => item),
          settings: {
            volume, slideDuration, fontSize, fitMode, zoom, waitingTitle, waitingSubtitle
          },
          exportDate: new Date().toISOString()
        };
        
        const blob = new Blob([JSON.stringify(exportObj, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `apresentacao-${Date.now()}.json`;
        a.click();
        URL.revokeObjectURL(url);
        
        showToast('Exportado', 'Dados exportados com sucesso');
        
      } catch (error) {
        console.error('Export error:', error);
        showToast('Erro', 'Erro ao exportar dados', 'destructive');
      }
    }

    async function saveAllData() {
      try {
        await dbPut('settings', {
          key: 'appSettings',
          volume, slideDuration, fontSize, fitMode, zoom, waitingTitle, waitingSubtitle
        });
        
        showToast('Salvo', 'Todas as configurações foram salvas');
      } catch (error) {
        console.error('Save error:', error);
        showToast('Erro', 'Erro ao salvar dados', 'destructive');
      }
    }

    // ============================================
    // MOBILE SIDEBAR
    // ============================================
    function toggleMobileSidebar() {
      const sidebar = document.getElementById('control-sidebar');
      const overlay = document.getElementById('sidebar-overlay');
      sidebar.classList.toggle('open');
      overlay.classList.toggle('hidden');
    }

    // ============================================
    // HELP DIALOG
    // ============================================
    function showHelpDialog() {
      document.getElementById('help-dialog').classList.remove('hidden');
    }

    function hideHelpDialog() {
      document.getElementById('help-dialog').classList.add('hidden');
    }

    // ============================================
    // KEYBOARD SHORTCUTS
    // ============================================
    function setupKeyboardShortcuts() {
      document.addEventListener('keydown', (e) => {
        if (currentPage === 'projector-control') {
          if (e.key === 'ArrowLeft') {
            e.preventDefault();
            previousSlide();
          } else if (e.key === 'ArrowRight') {
            e.preventDefault();
            nextSlide();
          } else if (e.key === 'F1') {
            e.preventDefault();
            if (!isLive) toggleLive();
          } else if (e.key === 'F2') {
            e.preventDefault();
            if (isLive) toggleLive();
          } else if (e.key === 'F9') {
            e.preventDefault();
            toggleAutoPlay();
          } else if (e.key === 'Escape') {
            hideHelpDialog();
            hideTextSlideModal();
          }
        }
      });
    }
  </script>
</body>
</html>
